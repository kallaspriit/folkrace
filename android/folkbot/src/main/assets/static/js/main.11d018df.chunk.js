(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(t,e,n){"use strict";n.r(e);var a,i,r=n(0),o=n.n(r),s=n(30),c=n.n(s),l=(n(70),n(6)),u=n(2),h=n(3),d=n(10),f=n(7),v=n(8),g=n(108),p=n(111),m=n(62),y=n(109),b=n(5),O=n(9),w=n(51),x=n(39),S=n(4),E=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={roll:0,pitch:0,yaw:0,lastUpdated:new Date},n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"setAttitude",value:function(t){return this.setState(Object(S.a)({},t,{lastUpdated:new Date}))}}]),e}(O.a),k=n(11);!function(t){t.START="START",t.LEFT="LEFT",t.RIGHT="RIGHT"}(a||(a={})),function(t){t.UNKNOWN="UNKNOWN",t.PRESSED="PRESSED",t.RELEASED="RELEASED"}(i||(i={}));var j,T=function(t){function e(){var t,n,r;Object(u.a)(this,e);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(r=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(s)))).state=(n={},Object(k.a)(n,a.START,i.UNKNOWN),Object(k.a)(n,a.LEFT,i.UNKNOWN),Object(k.a)(n,a.RIGHT,i.UNKNOWN),n),r}return Object(v.a)(e,t),Object(h.a)(e,[{key:"setButtonState",value:function(t,e){return this.setState(Object(k.a)({},t,e))}}]),e}(O.a),C=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={isStarted:!1,isValid:!1,targetRpm:0,currentRpm:0,motorPwm:0},n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"update",value:function(t){return this.setState(Object(S.a)({},t))}}]),e}(O.a),N=n(18);!function(t){t.INFO="INFO",t.ERROR="ERROR",t.RX="RX",t.TX="TX"}(j||(j={}));var M,D,R,A,z=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={entries:[]},n.lastId=0,n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"addEntry",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState(function(a){var i=e.state.entries.length>0?e.state.entries[e.state.entries.length-1]:null,r=e.resolveMessageType(t);if(null!==i&&n&&t===i.message)return{entries:[].concat(Object(N.a)(a.entries.slice(0,e.state.entries.length-1)),[{id:(e.lastId++).toString(),time:new Date,message:t,type:r,count:i.count+1}])};for(var o=[].concat(Object(N.a)(a.entries),[{id:(e.lastId++).toString(),time:new Date,message:t,type:r,count:1}]);o.length>200;)o.shift();return{entries:o}}).catch(function(t){return console.error(t)})}},{key:"clear",value:function(){this.setState({entries:[]}).catch(function(t){return console.error(t)})}},{key:"resolveMessageType",value:function(t){switch(t.substr(0,1)){case"<":return j.RX;case">":return j.TX;case"@":return j.ERROR;case"#":default:return j.INFO}}}]),e}(O.a),I=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={measurements:[]},n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"add",value:function(t){var e=[].concat(Object(N.a)(this.state.measurements),[t]);return e.length>360&&e.shift(),this.setState({measurements:e})}}]),e}(O.a),L=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={left:0,right:0},n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"update",value:function(t,e){return this.setState({left:t,right:e})}}]),e}(O.a),P=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={targetSpeed:{left:0,right:0},current:{left:0,right:0}},n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"setTargetSpeed",value:function(t,e){return this.setState({targetSpeed:{left:t,right:e}})}},{key:"setCurrent",value:function(t,e){return this.setState({current:{left:t,right:e}})}}]),e}(O.a),F=n(52),G=n.n(F),W={webSocket:{host:void 0!==localStorage.webSocketHost?localStorage.webSocketHost:"127.0.0.1",port:void 0!==localStorage.webSocketPort?parseInt(localStorage.webSocketPort,10):8e3,useSSL:!1,reconnectInterval:3e3},rules:{battery:{low:15,critical:13.5}},vehicle:{trackWidth:.15,maxSpeed:1,wheelDiameter:.039,encoderCountsPerRotation:20,gearboxRatio:25,speedUpdateInterval:50}};!function(t){t.DISCONNECTED="DISCONNECTED",t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED"}(M||(M={})),function(t){t.USB="usb",t.BLUETOOTH="bluetooth"}(D||(D={})),function(t){t.CONNECTING="CONNECTING",t.CONNECTED="CONNECTED",t.DISCONNECTED="DISCONNECTED",t.NOT_SUPPORTED="NOT_SUPPORTED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.DISABLED="DISABLED"}(R||(R={})),function(t){t.UNKNOWN="UNKNOWN",t.FULL="FULL",t.LOW="LOW",t.CRITICAL="CRITICAL"}(A||(A={}));var U=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).state={serials:{BLUETOOTH:{type:D.BLUETOOTH,state:R.DISCONNECTED,deviceName:void 0},USB:{type:D.USB,state:R.DISCONNECTED,deviceName:void 0}},transportState:M.DISCONNECTED},n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"setSerialState",value:function(t,e,n){var a=Object.keys(D).find(function(e){return D[e]===t});return this.setState(G()(this.state,{serials:Object(k.a)({},a,{$merge:{state:e,deviceName:n}})}))}},{key:"setTransportState",value:function(t){return this.setState({transportState:t})}},{key:"setBatteryVoltage",value:function(t){return this.setState({batteryVoltage:t})}},{key:"setRemoteIp",value:function(t){return this.setState({remoteIp:t})}},{key:"setOffline",value:function(){return this.setState({remoteIp:void 0})}},{key:"setLoopStatistics",value:function(t,e){return this.setState({lastBeaconTime:new Date,loopFrequency:t,loopTimeUs:e})}},{key:"setResetReceived",value:function(){return this.setState({lastResetTime:new Date})}},{key:"getConnectedSerial",value:function(){var t=this;return Object.keys(this.state.serials).map(function(e){return t.state.serials[e]}).find(function(t){return t.state===R.CONNECTED})}},{key:"batteryState",get:function(){var t=this.state.batteryVoltage;return void 0===t?A.UNKNOWN:t<=W.rules.battery.critical?A.CRITICAL:t<=W.rules.battery.low?A.LOW:A.FULL}}]),e}(O.a);var B=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(u.a)(this,t),this.transport=e,this.pingSentTime=void 0,this.config=void 0,this.config=Object(S.a)({targetLidarRpm:300},n)}return Object(h.a)(t,[{key:"requestVoltage",value:function(){this.send("voltage")}},{key:"requestState",value:function(){this.send("state")}},{key:"setSpeed",value:function(t,e){this.send("s",t,e)}},{key:"ping",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pingSentTime=Date.now(),t?this.send("!ping"):this.send("ping")}},{key:"startLidar",value:function(){this.send("rpm:".concat(this.config.targetLidarRpm))}},{key:"stopLidar",value:function(){this.send("rpm:0")}},{key:"send",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];var i="".concat(t).concat(n.length>0?":":"").concat(n.join(":"));this.transport.send(i)}}]),t}(),H=n(17),q=n.n(H),V=n(20),X=n(16),K=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(u.a)(this,t),this.options=void 0,this.log=void 0,this.listeners=[],this.transports=[],this.options=Object(S.a)({log:X.dummyLogger},e),this.log=this.options.log}return Object(h.a)(t,[{key:"getName",value:function(){var t=this.getActiveTransport();return t?t.getName():"None"}},{key:"isAvailable",value:function(){return void 0!==this.getAvailableTransport()}},{key:"getState",value:function(){var t=this.getActiveTransport();return t?t.getState():M.DISCONNECTED}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"connect",value:function(){var t=Object(V.a)(q.a.mark(function t(){var e;return q.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.transports.map(function(t){return t.getState()!==M.DISCONNECTED?Promise.resolve():t.connect()}),t.next=3,Promise.all(e);case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"send",value:function(t){var e=this,n=this.getConnectedTransport();return n?n.send(t):(this.log.warn('sending message "'.concat(t,'" requested but there is no connected transport available')),this.listeners.forEach(function(n){return n.onMessageSent(e,t,!1)}),!1)}},{key:"addTransport",value:function(t){var e=this;t.addListener({onStateChanged:function(t,n,a){var i=e.getActiveTransport();t===i&&e.listeners.forEach(function(e){return e.onStateChanged(t,n,a)})},onError:function(t,n){var a=e.getActiveTransport();t===a&&e.listeners.forEach(function(e){return e.onError(t,n)})},onMessageSent:function(t,n,a){var i=e.getActiveTransport();t===i&&e.listeners.forEach(function(e){return e.onMessageSent(t,n,a)})},onMessageReceived:function(t,n){var a=e.getActiveTransport();t===a&&e.listeners.forEach(function(e){return e.onMessageReceived(t,n)})}}),this.transports.push(t)}},{key:"getAvailableTransport",value:function(){return this.transports.find(function(t){return t.isAvailable()})}},{key:"getConnectedTransport",value:function(){return this.transports.find(function(t){return t.getState()===M.CONNECTED})}},{key:"getActiveTransport",value:function(){var t=this.getConnectedTransport();return t||this.getAvailableTransport()}}]),t}(),_=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(u.a)(this,t),this.options=void 0,this.log=void 0,this.listeners=[],this.bridgeExists=void 0,this.state=M.DISCONNECTED,this.native=void 0,this.options=Object(S.a)({log:X.dummyLogger},e),this.log=this.options.log,this.bridgeExists=void 0!==window.native}return Object(h.a)(t,[{key:"getName",value:function(){return"Native"}},{key:"isAvailable",value:function(){return this.bridgeExists}},{key:"getState",value:function(){return this.state}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"connect",value:function(){var t=Object(V.a)(q.a.mark(function t(){var e=this;return q.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.setState(M.CONNECTING),void 0!==window.native){t.next=5;break}return this.log.info("no native bridge is available"),this.setState(M.DISCONNECTED),t.abrupt("return");case 5:this.log.info("native bridge is available"),this.native=window.native,window.app={receive:function(t){return e.onMessageReceived(t)}},this.send("!handshake"),this.setState(M.CONNECTING);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"send",value:function(t){var e=this;if(!this.native)return this.log.warn('sending message "'.concat(t,'" requested but the native bridge is not available')),this.listeners.forEach(function(n){return n.onMessageSent(e,t,!1)}),!1;try{return this.native.receive(t),this.listeners.forEach(function(n){return n.onMessageSent(e,t,!0)}),!0}catch(n){this.listeners.forEach(function(t){return t.onError(e,n)})}return!1}},{key:"setState",value:function(t){var e=this;if(t!==this.state){var n=this.state;this.state=t,this.listeners.forEach(function(a){return a.onStateChanged(e,t,n)})}}},{key:"onMessageReceived",value:function(t){var e=this;this.log.info('received: "'.concat(t,'"')),this.listeners.forEach(function(n){return n.onMessageReceived(e,t)}),"!handshake"===t&&this.setState(M.CONNECTED)}}]),t}())({}),J=new(function(){function t(e){Object(u.a)(this,t),this.options=void 0,this.log=void 0,this.listeners=[],this.state=M.DISCONNECTED,this.wasConnected=!1,this.ws=void 0,this.options=Object(S.a)({useSSL:!1,log:X.dummyLogger,reconnectInterval:1e3},e),this.log=this.options.log}return Object(h.a)(t,[{key:"getName",value:function(){return"WebSocket"}},{key:"isAvailable",value:function(){return void 0!==WebSocket}},{key:"getState",value:function(){return this.state}},{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"connect",value:function(){var t=Object(V.a)(q.a.mark(function t(){var e,n=this;return q.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e="".concat(this.options.useSSL?"wss":"ws","://").concat(this.options.host,":").concat(this.options.port),this.log.info("connecting to web-socket server at ".concat(e)),this.setState(this.wasConnected?M.RECONNECTING:M.CONNECTING),this.ws=new WebSocket(e),this.ws.onopen=function(t){n.log.info("established web-socket connection"),n.wasConnected=!0,n.setState(M.CONNECTED)},this.ws.onclose=function(t){var e="code: ".concat(t.code,", reason: ").concat(t.reason,", was clean: ").concat(t.wasClean?"yes":"no");n.wasConnected?n.log.warn("connection to web-socket was lost (".concat(e,")")):n.log.warn("connecting to web-socket failed (".concat(e,")")),n.setState(M.DISCONNECTED),setTimeout(function(){n.connect()},n.options.reconnectInterval)},this.ws.onerror=function(t){n.log.warn("got web-socket error"),n.listeners.forEach(function(t){return t.onError(n)})},this.ws.onmessage=function(t){var e=t.data;n.listeners.forEach(function(t){return t.onMessageReceived(n,e)})};case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"send",value:function(t){var e=this;return this.ws&&this.state===M.CONNECTED?(this.ws.send(t),this.listeners.forEach(function(n){return n.onMessageSent(e,t,!0)}),!0):(this.log.warn('sending message "'.concat(t,'" requested but websocket state is ').concat(this.state)),this.listeners.forEach(function(n){return n.onMessageSent(e,t,!1)}),!1)}},{key:"setState",value:function(t){var e=this;if(t!==this.state){var n=this.state;this.state=t,this.listeners.forEach(function(a){return a.onStateChanged(e,t,n)})}}}]),t}())(Object(S.a)({},W.webSocket)),Y=new K({});Y.addTransport(_),Y.addTransport(J);var $=new B(Y);function Q(){return(Q=Object(V.a)(q.a.mark(function t(e,n){var a,i,r,o,s;return q.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.status,i=e[0],r=e[1],o="string"===typeof e[2]?e[2]:void 0,t.next=6,a.setSerialState(i,r,o);case 6:void 0!==(s=a.getConnectedSerial())&&i===s.type?$.requestState():a.setBatteryVoltage(void 0);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}var Z={serial:function(t,e){return Q.apply(this,arguments)},ip:function(t,e){var n=e.status,a=t[0];"null"===a?n.setOffline():n.setRemoteIp(a)},usb:function(t,e){},voltage:function(t,e){var n=e.status,a=parseFloat(t[0]);n.setBatteryVoltage(a)},button:function(t,e){var n=e.button,a=t[0],r=0===parseInt(t[1],10)?i.PRESSED:i.RELEASED;n.setButtonState(a.toUpperCase(),r)},reset:function(t,e){e.status.setResetReceived()},current:function(t,e){var n=e.robot,a=parseInt(t[0],10),i=parseInt(t[1],10);n.setCurrent(a,i)},lidar:function(t,e){var n=e.lidar,a=1===parseInt(t[0],10),i=1===parseInt(t[1],10),r=parseFloat(t[2]),o=parseFloat(t[3]),s=parseFloat(t[4]);n.update({isStarted:a,isValid:i,targetRpm:r,currentRpm:o,motorPwm:s})},pong:function(t,e){var n=e.log;if($.pingSentTime){var a=Date.now()-$.pingSentTime;$.pingSentTime=void 0,n.addEntry("# ping: ".concat(a," ms"))}},e:function(t,e){var n=e.odometry,a=parseInt(t[0],10),i=parseInt(t[1],10);n.update(a,i)},b:function(t,e){var n=e.status,a=parseInt(t[0],10),i=parseInt(t[1],10),r=i/a*1e3,o=a/i*1e3;n.setLoopStatistics(r,o)},l:function(t,e){for(var n=e.measurements,a=0;a<4;a++)n.add({angle:parseInt(t[0+3*a],10),distance:parseInt(t[1+3*a],10),quality:parseInt(t[2+3*a],10),timestamp:Date.now()})},s:function(t,e){var n=e.robot,a=parseInt(t[0],10),i=parseInt(t[1],10);n.setTargetSpeed(a,i)},a:function(t,e){e.ahrs.setAttitude({roll:parseFloat(t[0]),pitch:parseFloat(t[1]),yaw:parseFloat(t[2])})}};var tt={};var et=[],nt=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).isInitialized=!1,n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){var t=this;return o.a.createElement(O.c,{to:[z,U,L,C,T,P,I,E]},function(e,n,a,i,r,o,s,c){if(t.isInitialized)return null;var l,u,h={log:e,status:n,odometry:a,lidar:i,button:r,robot:o,measurements:s,ahrs:c};return l=h,Object.keys(l).forEach(function(t){var e=t;tt[e]=l[e]}),u=function(t){return e.addEntry(t)},et.push(u),n.setTransportState(Y.getState()),Y.addListener({onStateChanged:function(t,a,i){e.addEntry("# ".concat(t.getName()," state changed to ").concat(a)),n.setTransportState(a)},onError:function(t,n){e.addEntry("# transport error occurred".concat(n?" (".concat(n.message,")"):""))},onMessageSent:function(t,n,a){var i=n.split(":"),r=Object(x.a)(i,1)[0];1===r.length||["ping","!ping"].includes(r)||e.addEntry("> ".concat(n).concat(a?"":" (sending failed)"))},onMessageReceived:function(e,n){t.handleTransportMessage(n,h)}}),Y.connect(),t.isInitialized=!0,null})}},{key:"handleTransportMessage",value:function(t,e){if(0!==t.length){var n=t.split(":"),a=Object(w.a)(n),i=a[0],r=a.slice(1);i.length>1&&-1===["pong","lidar"].indexOf(i)&&e.log.addEntry("< ".concat(t)),function(t,e,n){var a=Z[t];void 0!==a?a(e,n):console.warn('missing web-socket command handler for "'.concat(t,'" (').concat(e.join(", "),")"))}(i,r,e)}}}]),e}(o.a.Component),at=n(25),it=n(110);function rt(){var t=Object(l.a)(["\n  display: block;\n  width: ","px;\n  height: ","px;\n  mask-image: url(",");\n  mask-size: ","px ","px;\n  mask-repeat: no-repeat;\n  mask-position: center center;\n  background-color: ",";\n"]);return rt=function(){return t},t}var ot=b.d.i(rt(),function(t){return t.width},function(t){return t.height},function(t){return t.url},function(t){return t.height},function(t){return t.width},function(t){return t.theme.text.primary}),st=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/status.svg",width:37,height:32}))},ct=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/map.svg",width:32,height:32}))},lt=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/bot.svg",width:27,height:32}))},ut=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/remote.svg",width:44,height:32}))},ht=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/settings.svg",width:32,height:32}))},dt=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/bluetooth.svg",width:32,height:32}))},ft=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/serial.svg",width:32,height:32}))},vt=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/websocket.svg",width:32,height:32}))},gt=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/native.svg",width:32,height:32}))},pt=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/battery.svg",width:32,height:32}))},mt=function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/lidar.svg",width:32,height:32}))};function yt(){var t=Object(l.a)(["\n  text-align: center;\n  font-variant: ",";\n  line-height: 1.2em;\n"]);return yt=function(){return t},t}var bt=b.d.div(yt(),function(t){return t.primary?"all-small-caps":"normal"});function Ot(){var t=Object(l.a)(["\n  padding-top: 4px;\n"]);return Ot=function(){return t},t}function wt(){var t=Object(l.a)(["\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n  text-decoration: none;\n  color: ",";\n  background-color: rgba(0, 0, 0, 0);\n  transition: background-color 300ms;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n\n  &.active-main-menu-item {\n    background-color: ",";\n    color: ",";\n  }\n"]);return wt=function(){return t},t}function xt(){var t=Object(l.a)(["\n  height: 100%;\n  text-align: center;\n  font-variant: small-caps;\n  text-transform: uppercase;\n  font-size: 0.8em;\n  flex: 1;\n"]);return xt=function(){return t},t}function St(){var t=Object(l.a)(["\n  display: flex;\n  flex-direction: row;\n  height: ",";\n  flex: 1;\n  max-width: 600px;\n"]);return St=function(){return t},t}function Et(){var t=Object(l.a)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  background-color: #000;\n"]);return Et=function(){return t},t}var kt=b.d.div(Et()),jt=b.d.ul(St(),function(t){return t.theme.size.menuHeight}),Tt=b.d.li(xt()),Ct=Object(b.d)(it.a)(wt(),function(t){return Object(at.a)(t.theme.size.darkerLighterPercentage,t.theme.text.primary)},function(t){return t.theme.bg.secondary},function(t){return t.theme.text.primary}),Nt=Object(b.d)(bt)(Ot()),Mt=function(){return o.a.createElement(kt,null,o.a.createElement(jt,null,o.a.createElement(Tt,null,o.a.createElement(Ct,{to:"/status",activeClassName:"active-main-menu-item"},o.a.createElement(st,null),o.a.createElement(Nt,null,"Status"))),o.a.createElement(Tt,null,o.a.createElement(Ct,{to:"/map",activeClassName:"active-main-menu-item"},o.a.createElement(ct,null),o.a.createElement(Nt,null,"Map"))),o.a.createElement(Tt,null,o.a.createElement(Ct,{to:"/simulation",activeClassName:"active-main-menu-item"},o.a.createElement(lt,null),o.a.createElement(Nt,null,"Simulation"))),o.a.createElement(Tt,null,o.a.createElement(Ct,{to:"/remote",activeClassName:"active-main-menu-item"},o.a.createElement(ut,null),o.a.createElement(Nt,null,"Remote"))),o.a.createElement(Tt,null,o.a.createElement(Ct,{to:"/settings",activeClassName:"active-main-menu-item"},o.a.createElement(ht,null),o.a.createElement(Nt,null,"Settings")))))};function Dt(){var t=Object(l.a)(['\n  // main font\n  @font-face {\n    font-family: "heebo-regular";\n    src: url("fonts/Heebo-Regular.ttf");\n  }\n\n  @font-face {\n    font-family: "roboto-mono-light";\n    src: url("fonts/RobotoMono-Light.ttf");\n  }\n\n  // default to using border box sizing\n  html {\n    box-sizing: border-box;\n  }\n  *,\n  *:before,\n  *:after {\n    box-sizing: inherit;\n  }\n\n  // set body styles\n  body,\n  html {\n    height: 100%;\n    padding: 0;\n    margin: 0;\n    font-family: "heebo-regular";\n    color: ',";\n    background-color: ",";\n  }\n"]);return Dt=function(){return t},t}function Rt(){var t=Object(l.a)(["\n      0% {\n        background: ",";\n      }\n      50% {\n        background: ",";\n      }\n      100% {\n        background: ",";\n      }\n    "]);return Rt=function(){return t},t}function At(){var t=Object(l.a)(["\n      from {\n        opacity: 0;\n      }\n      to {\n        opacity: 1;\n      }\n    "]);return At=function(){return t},t}var zt={text:{primary:"#f0f0f0",secondary:"#969696"},bg:{primary:"#cc3333",secondary:"#282828",tertiary:Object(at.b)(.05,"#282828"),quaternary:"#087099",good:"#009900",warn:"#999900",bad:"#990000"},size:{darkerLighterPercentage:.25,gridGap:"2px",menuHeight:"64px"},animation:{fadeIn:Object(b.e)(At()),pulse:function(t){return Object(b.e)(Rt(),t,Object(at.b)(.25,t),t)}}},It=Object(b.b)(Dt(),zt.text.primary,zt.bg.secondary),Lt=n(55);function Pt(){var t=Object(l.a)(["\n  position: relative;\n  flex: 1;\n  border-radius: 8px 8px 0 0;\n  padding: ",";\n"]);return Pt=function(){return t},t}var Ft,Gt=b.d.div(Pt(),function(t){return t.text?"16px":"0"}),Wt=[{angle:0,distance:50,quality:100,timestamp:Date.now()},{angle:90,distance:100,quality:50,timestamp:Date.now()}],Ut=function(){return o.a.createElement(Gt,null,o.a.createElement(Lt.a,{radius:2,cellSize:.1,measurements:function(){return Wt}}))};function Bt(){var t=Object(l.a)(["\n          animation: "," 3s ease;\n          animation-iteration-count: infinite;\n          animation-delay: 1s;\n        "]);return Bt=function(){return t},t}function Ht(){var t=Object(l.a)(["\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 16px;\n          overflow: hidden;\n          background-color: ",";\n        "]);return Ht=function(){return t},t}function qt(){var t=Object(l.a)(["\n          line-height: 1.25em;\n          text-align: center;\n          margin-top: 8px;\n        "]);return qt=function(){return t},t}function Vt(){var t=Object(l.a)(["\n  position: relative;\n  background-color: ",";\n  font-variant: ",";\n\n  ","\n\n  ","\n\n  ","\n"]);return Vt=function(){return t},t}function Xt(){var t=Object(l.a)(["\n          grid-template-rows: ",";\n        "]);return Xt=function(){return t},t}function Kt(){var t=Object(l.a)(["\n          grid-template-columns: ",";\n        "]);return Kt=function(){return t},t}function _t(){var t=Object(l.a)(["\n  display: grid;\n  grid-gap: ",";\n  margin: ",";\n  height: calc(100vh - ("," + ("," * 2)));\n\n  ","\n\n  ","\n"]);return _t=function(){return t},t}!function(t){t.GOOD="GOOD",t.WARN="WARN",t.BAD="BAD"}(Ft||(Ft={}));var Jt=b.d.div(_t(),function(t){return t.theme.size.gridGap},function(t){return t.theme.size.gridGap},function(t){return t.theme.size.menuHeight},function(t){return t.theme.size.gridGap},function(t){return t.columns?Object(b.c)(Kt(),t.columns):""},function(t){return t.rows?Object(b.c)(Xt(),t.rows):""}),Yt=function(t){var e;return e={},Object(k.a)(e,Ft.GOOD,t.bg.good),Object(k.a)(e,Ft.WARN,t.bg.warn),Object(k.a)(e,Ft.BAD,t.bg.bad),e},$t=b.d.div(Vt(),function(t){return t.theme.bg.tertiary},function(t){return t.primary?"all-small-caps":"normal"},function(t){return t.text?Object(b.c)(qt()):""},function(t){return t.status?Object(b.c)(Ht(),Yt(t.theme)[t.status]):""},function(t){return t.status===Ft.BAD?Object(b.c)(Bt(),t.theme.animation.pulse(Yt(t.theme)[t.status])):""}),Qt=n(57),Zt=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).ref=o.a.createRef(),n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){var t=this,e=this.ref.current;if(e){var n=Object(Qt.create)({zone:e,color:"#FFF",size:200,position:{left:"50%",top:"50%"},mode:"static",lockX:!0===this.props.x,lockY:!0===this.props.y}),a=this.props.onEvent;if("function"===typeof a){var i="start,move,end,dir,plain";n.on(i,function(e,n){a(t.props.name,e,n)}),n.on("removed",function(t,e){e.off(i)})}}else console.warn("grid item dom node not found")}},{key:"render",value:function(){return o.a.createElement("div",{className:"joystick",ref:this.ref})}}]),e}(o.a.Component),te=n(58),ee=n.n(te),ne=function(){function t(e){Object(u.a)(this,t),this.options=e}return Object(h.a)(t,[{key:"calculateMotorSpeeds",value:function(t,e){return this.limit({left:t+e,right:t-e},this.options.maxSpeed)}},{key:"getSpeedEncoderCount",value:function(t){var e=t/(this.options.wheelDiameter*Math.PI)*(this.options.encoderCountsPerRotation*this.options.gearboxRatio);return Math.floor(e)}},{key:"limit",value:function(t,e){var n=Math.max(Math.abs(t.left),Math.abs(t.right)),a=Math.min(e/n,1);return{left:t.left*a,right:t.right*a}}},{key:"getEncoderSpeeds",value:function(t){return{left:this.getSpeedEncoderCount(t.left),right:this.getSpeedEncoderCount(t.right)}}}]),t}(),ae=function(){function t(e){var n=this;Object(u.a)(this,t),this.options=void 0,this.kinematics=void 0,this.robot=void 0,this.speed=0,this.omega=0,this.scheduleUpdateMotorSpeeds=void 0,this.options=Object(S.a)({log:X.dummyLogger},e),this.robot=this.options.robot,this.kinematics=new ne(this.options.vehicle),this.scheduleUpdateMotorSpeeds=ee()(function(){return n.updateMotorSpeeds()},this.options.vehicle.speedUpdateInterval)}return Object(h.a)(t,[{key:"setSpeed",value:function(t){this.speed=t,this.scheduleUpdateMotorSpeeds()}},{key:"setOmega",value:function(t){this.omega=t,this.scheduleUpdateMotorSpeeds()}},{key:"updateMotorSpeeds",value:function(){var t=this.kinematics.calculateMotorSpeeds(this.speed,this.omega),e=this.kinematics.getEncoderSpeeds(t);this.robot.setSpeed(e.left,e.right)}}]),t}(),ie=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).remoteController=new ae({log:console,vehicle:W.vehicle,robot:$}),n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){var t=this;return o.a.createElement(Gt,null,o.a.createElement(Jt,null,o.a.createElement($t,null,o.a.createElement(Zt,{x:!0,name:"speed",onEvent:function(e,n,a){return t.onJoystickEvent(e,n,a)}})),o.a.createElement($t,null,o.a.createElement(Zt,{y:!0,name:"omega",onEvent:function(e,n,a){return t.onJoystickEvent(e,n,a)}}))))}},{key:"onJoystickEvent",value:function(t,e,n){if(-1!==["move","end"].indexOf(e.type)){var a="move"===e.type,i=a?Math.sin(n.angle.radian)*n.distance:0,r=a?Math.cos(n.angle.radian)*n.distance:0;switch(t){case"speed":this.remoteController.setSpeed(-1*r/100);break;case"omega":this.remoteController.setOmega(i/100);break;default:throw new Error('Got unexpected joystick "'.concat(t,'" info'))}}}}]),e}(o.a.Component),re=function(){return o.a.createElement(Gt,{text:!0},o.a.createElement("button",{onClick:function(){return window.location.href="http://kallaspriit"}},"Open http://kallaspriit"))},oe=n(59),se=function(){return o.a.createElement(Gt,null,o.a.createElement(oe.a,null))};var ce=function(){return o.a.createElement(O.c,{to:[U]},function(t){var e=function(t){switch(t){case A.UNKNOWN:return Ft.BAD;case A.FULL:return Ft.GOOD;case A.LOW:return Ft.WARN;case A.CRITICAL:return Ft.BAD;default:return function(t,e){throw new Error("".concat(e," (").concat(t,")"))}(t,"got unexpected battery state")}}(t.batteryState),n=t.state.batteryVoltage?"".concat(t.state.batteryVoltage.toFixed(1),"V"):"Unknown";return o.a.createElement($t,{status:e,onClick:function(){return $.requestVoltage()}},o.a.createElement(pt,null),o.a.createElement(bt,{primary:!0},"Battery"),o.a.createElement(bt,null,n))})};var le=function(){return o.a.createElement(O.c,{to:[C]},function(t){var e=function(t){var e=Ft.BAD,n="Stopped";t.state.isValid?(e=Ft.GOOD,n="".concat(Math.round(t.state.currentRpm),"/").concat(t.state.targetRpm," RPM")):t.state.isStarted&&(e=Ft.WARN,n="Unstable");return{status:e,description:n}}(t),n=e.status,a=e.description;return o.a.createElement($t,{status:n,onClick:function(){return t.state.isStarted?$.stopLidar():$.startLidar()}},o.a.createElement(mt,null),o.a.createElement(bt,{primary:!0},"Lidar"),o.a.createElement(bt,null,a))})};function ue(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:" ",a="string"===typeof t?t:t.toString();if(a.length>=e)return a;var i=e-a.length;return"".concat(new Array(i+1).join(n)).concat(a)}var he,de=n(63),fe=function(t){function e(){var t,n;Object(u.a)(this,e);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).ref=o.a.createRef(),n}return Object(v.a)(e,t),Object(h.a)(e,[{key:"componentDidUpdate",value:function(){if(!1!==this.props.scrollToBottom){var t=this.ref.current;if(t)t.scrollHeight-t.clientHeight<=t.scrollTop+50&&(t.scrollTop=t.scrollHeight-t.clientHeight);else console.warn("auto-scroll dom node not found")}}},{key:"render",value:function(){var t=this.props,e=(t.scrollToBottom,Object(de.a)(t,["scrollToBottom"]));return o.a.createElement("div",Object.assign({},e,{ref:this.ref}),this.props.children)}}]),e}(o.a.Component);function ve(){var t=Object(l.a)(["\n  background-color: ",";\n"]);return ve=function(){return t},t}function ge(){var t=Object(l.a)(["\n  box-sizing: content-box;\n  position: absolute;\n  bottom: ",";\n  right: ",";\n  width: 32px;\n  height: 32px;\n  padding: 10px;\n  background-color: ",";\n"]);return ge=function(){return t},t}function pe(){var t=Object(l.a)(["\n  display: inline-block;\n  padding: 0 4px;\n  margin-left: 8px;\n  border-radius: 8px;\n  background-color: ",";\n  color: ",";\n"]);return pe=function(){return t},t}function me(){var t=Object(l.a)(["\n  padding-left: 6px;\n  border-left: 2px solid ",";\n  margin-left: 6px;\n"]);return me=function(){return t},t}function ye(){var t=Object(l.a)(["\n  color: ",";\n"]);return ye=function(){return t},t}function be(){var t=Object(l.a)([""]);return be=function(){return t},t}function Oe(){var t=Object(l.a)(["\n  flex: 1;\n  overflow: scroll;\n  padding: 8px;\n"]);return Oe=function(){return t},t}function we(){var t=Object(l.a)(['\n  grid-column: 1 / 4;\n  font-family: Consolas, "Courier New", Courier, monospace;\n  display: flex;\n  overflow: hidden;\n']);return we=function(){return t},t}var xe=Object(b.d)($t)(we()),Se=Object(b.d)(fe)(Oe()),Ee=b.d.div(be()),ke=b.d.span(ye(),function(t){return t.theme.text.secondary}),je=(he={},Object(k.a)(he,j.INFO,"#666"),Object(k.a)(he,j.RX,"#090"),Object(k.a)(he,j.TX,"#FF8000"),Object(k.a)(he,j.ERROR,"#900"),he),Te=b.d.span(me(),function(t){return je[t.type]}),Ce=b.d.span(pe(),function(t){return t.theme.text.primary},function(t){return t.theme.bg.tertiary}),Ne=b.d.div(ge(),function(t){return t.theme.size.gridGap},function(t){return t.theme.size.gridGap},function(t){return t.theme.bg.tertiary}),Me=Object(b.d)(function(t){return o.a.createElement(ot,Object.assign({},t,{url:"icons/clear.svg",width:32,height:32}))})(ve(),function(t){return t.theme.text.secondary}),De=function(){return o.a.createElement(O.c,{to:[z]},function(t){return o.a.createElement(xe,null,o.a.createElement(Se,null,t.state.entries.map(function(t){return o.a.createElement(Ee,{key:t.id},o.a.createElement(ke,null,(e=t.time,"".concat(ue(e.getHours(),2,"0"),":")+"".concat(ue(e.getMinutes(),2,"0"),":")+"".concat(ue(e.getSeconds(),2,"0"),".")+"".concat(ue(e.getMilliseconds(),3,"0")))),o.a.createElement(Te,{type:t.type},t.message),t.count>1?o.a.createElement(Ce,null,t.count):null);var e})),o.a.createElement(Ne,{onClick:function(){return t.clear()}},o.a.createElement(Me,null)))})},Re=n(37),Ae=n.n(Re),ze=function(){return o.a.createElement(O.c,{to:[U]},function(t){var e=t.state.transportState===M.CONNECTED?Ft.GOOD:Ft.BAD,n=t.state.transportState!==M.CONNECTED||void 0===t.state.remoteIp?Ae()(t.state.transportState):t.state.remoteIp;return o.a.createElement($t,{status:e,onClick:function(){return $.ping(void 0===t.getConnectedSerial())}},"Native"===Y.getName()?o.a.createElement(gt,null):o.a.createElement(vt,null),o.a.createElement(bt,{primary:!0},Y.getName()),o.a.createElement(bt,null,n))})},Ie=function(){return o.a.createElement(O.c,{to:[U]},function(t){var e=t.getConnectedSerial(),n=void 0!==e?Ft.GOOD:Ft.BAD,a=e&&e.type===D.BLUETOOTH?dt:ft,i=e?e.type:"Serial",r=Ae()(e?e.state:"Disconnected");return o.a.createElement($t,{status:n},o.a.createElement(a,null),o.a.createElement(bt,{primary:!0},i),o.a.createElement(bt,null,r))})},Le=function(){return o.a.createElement(Gt,null,o.a.createElement(Jt,{columns:"1fr 1fr 1fr",rows:"100px 100px"},o.a.createElement(Ie,null),o.a.createElement(ze,null),o.a.createElement(ce,null),o.a.createElement(le,null),o.a.createElement(De,null)))};function Pe(){var t=Object(l.a)(["\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  animation: "," 1000ms;\n"]);return Pe=function(){return t},t}var Fe=function(t){function e(){return Object(u.a)(this,e),Object(d.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){return o.a.createElement(b.a,{theme:zt},o.a.createElement(O.b,null,o.a.createElement(It,null),o.a.createElement(nt,null),o.a.createElement(g.a,null,o.a.createElement(Ge,null,o.a.createElement(p.a,null,o.a.createElement(m.a,{path:"/status",component:Le}),o.a.createElement(m.a,{path:"/map",component:Ut}),o.a.createElement(m.a,{path:"/remote",component:ie}),o.a.createElement(m.a,{path:"/simulation",component:se}),o.a.createElement(m.a,{path:"/settings",component:re}),o.a.createElement(m.a,null,o.a.createElement(y.a,{to:"/status"}))),o.a.createElement(Mt,null)))))}}]),e}(o.a.Component),Ge=b.d.div(Pe(),function(t){return t.theme.animation.fadeIn});c.a.render(o.a.createElement(Fe,null),document.getElementById("root"))},38:function(t,e,n){"use strict";var a=n(18),i=n(39),r=n(4),o=n(2),s=n(3),c=n(56),l=n.n(c),u=n(19),h=n.n(u);function d(t,e,n,a,i){var r=(t-e)*(i-a)/(n-e)+a;if(!(!(arguments.length>5&&void 0!==arguments[5])||arguments[5]))return r;var o=Math.min(a,i),s=Math.max(a,i);return Math.min(Math.max(r,o),s)}var f=function(){function t(e,n){var a=this;Object(o.a)(this,t),this.canvas=e,this.options=void 0,this.ctx=void 0,this.width=void 0,this.height=void 0,this.size=void 0,this.transform=void 0,this.mouseDownCounter=0,this.frameNumber=0,this.isRunning=!1,this.lastRenderTime=void 0,this.options=Object(r.a)({defaultStyle:{fillStyle:"#000",strokeStyle:"#000",font:"16px monospace",textBaseline:"top"},getTransform:function(t){return{}},render:function(t){},onMouseDownEvent:function(t){},onMouseUpEvent:function(t){},onMouseMoveEvent:function(t){}},n);var i=this.canvas.getContext("2d");if(!i)throw new Error("Getting layer 2D context failed, this should not happen");this.ctx=i,this.width=this.canvas.offsetWidth,this.height=this.canvas.offsetHeight,this.size=Math.min(this.width,this.height)-2,this.canvas.setAttribute("width","".concat(this.width.toString(),"px")),this.canvas.setAttribute("height","".concat(this.height.toString(),"px")),this.canvas.style.removeProperty("width"),this.canvas.style.removeProperty("height"),void 0===n.onMouseDownEvent&&void 0===n.onMouseUpEvent&&void 0===n.onMouseMoveEvent&&(this.canvas.style.pointerEvents="none"),this.transform=Object(r.a)({horizontalScaling:1,verticalSkewing:0,horizontalSkewing:0,verticalScaling:1,horizontalTranslation:0,verticalTranslation:0,rotation:0,scale:1},this.options.getTransform(this)),this.ctx.transform(this.transform.horizontalScaling,this.transform.verticalSkewing,this.transform.horizontalSkewing,this.transform.verticalScaling,this.transform.horizontalTranslation,this.transform.verticalTranslation),this.ctx.rotate(this.transform.rotation),this.applyStyle(this.options.defaultStyle),n.onMouseDownEvent&&(this.canvas.onmousedown=function(t){return a.handleMouseEvent("down",t)}),n.onMouseUpEvent&&(this.canvas.onmouseup=function(t){return a.handleMouseEvent("up",t)}),n.onMouseMoveEvent&&(this.canvas.onmousemove=function(t){return a.handleMouseEvent("move",t)})}return Object(s.a)(t,[{key:"start",value:function(){this.isRunning=!0,this.scheduleNextFrame()}},{key:"stop",value:function(){this.isRunning=!1}},{key:"drawCircle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{strokeStyle:"#000"},n=Object(r.a)({center:{x:0,y:0}},t),a=this.worldToScreen(n.center);this.ctx.save(),this.applyStyle(e),this.ctx.beginPath(),this.ctx.arc(a.x,a.y,this.scale(n.radius),0,2*Math.PI),e.fillStyle&&this.ctx.fill(),(e.strokeStyle||!e.strokeStyle&&!e.fillStyle)&&this.ctx.stroke(),this.ctx.restore()}},{key:"drawPulse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{strokeStyle:"#000"},n=Object(r.a)({center:{x:0,y:0},lifetime:300,age:0,size:this.size/50/this.getScale()},t);if(!(n.age>n.lifetime)){var a=d(n.age,0,n.lifetime,1,0),i=l()(e.fillStyle||"#F00").alpha(a).toString();this.drawCircle({center:n.center,radius:d(n.age,0,n.lifetime,n.size/10,n.size)},{fillStyle:i})}}},{key:"drawMarker",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.a)({size:this.size/100/this.getScale()},t),a=this.isPolar(n.center)?n.center.angle:0,i=this.worldToScreen(n.center),o=this.scale(n.size);this.ctx.save(),this.applyStyle(e),this.ctx.translate(i.x,i.y),this.ctx.rotate(a),this.ctx.fillRect(-o/2,-o/2,o,o),this.ctx.restore()}},{key:"drawBox",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.a)({padding:0,centered:!1},t),a=this.worldToScreen(n.origin),i=this.scale(n.width),o=this.scale(n.height),s=n.centered?{x:-i/2,y:-o/2}:{x:0,y:0};this.ctx.save(),this.applyStyle(e),e.fillStyle&&this.ctx.fillRect(a.x+s.x+n.padding,a.y+s.y+n.padding,i-2*n.padding,o-2*n.padding),(e.strokeStyle||!e.strokeStyle&&!e.fillStyle)&&this.ctx.strokeRect(a.x+s.x+n.padding,a.y+s.y+n.padding,i-2*n.padding,o-2*n.padding),this.ctx.restore()}},{key:"drawLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.a)({},t),a=this.worldToScreen(n.from),i=this.worldToScreen(n.to);this.ctx.save(),this.applyStyle(e),this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke(),this.ctx.restore()}},{key:"drawGrid",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Math.ceil(this.height/this.getScale()/t.cellHeight),a=Math.ceil(this.width/this.getScale()/t.cellWidth),i=Object(r.a)({origin:{x:0,y:0},centered:!1,rows:n%2===0?n:n+1,columns:a%2===0?a:a+1},t),o=i.cellHeight*i.rows,s=i.cellWidth*i.columns,c=this.toCartesian(i.origin),l=i.centered?{x:-s/2,y:-o/2}:{x:0,y:0},u=0;u<=i.rows;u++){var h=u*i.cellHeight;this.drawLine({from:{x:c.x+l.x,y:c.y+l.y+h},to:{x:c.x+l.x+s,y:c.y+l.y+h}},e)}for(var d=0;d<=i.columns;d++){var f=d*i.cellWidth;this.drawLine({from:{x:c.x+l.x+f,y:c.y+l.y},to:{x:c.x+l.x+f,y:c.y+l.y+o}},e)}}},{key:"drawOccupancyGrid",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e=Object(r.a)({origin:{x:0,y:0},centered:!1,path:[]},t);if(0!==e.grid.length){for(var n=e.grid.length,a=e.grid[0].length,o=e.cellWidth*a,s=e.cellHeight*n,c=this.toCartesian(e.origin),l=e.centered?{x:-o/2,y:-s/2}:{x:0,y:0},u=0;u<n;u++)for(var h=0;h<a;h++){if(!Array.isArray(e.grid[u]))throw new Error("Expected occupancy map row #".concat(u," to be an array, got ").concat(typeof e.grid[u]));var d=e.grid[u][h];if("number"!==typeof d)throw new Error("Expected occupancy map row cell ".concat(u,"x").concat(h," to be a number, got ").concat(typeof d));if(!(d<=0)){var f={x:h*e.cellWidth,y:u*e.cellHeight},v={x:c.x+l.x+f.x,y:c.y+l.y+f.y};this.drawBox({origin:v,width:e.cellWidth,height:e.cellHeight,padding:1},{fillStyle:"rgba(0, 0, 0, ".concat(d,")")})}}var g=!0,p=!1,m=void 0;try{for(var y,b=e.path[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var O=y.value,w=Object(i.a)(O,2),x=w[0],S=w[1],E={x:x*e.cellWidth,y:S*e.cellHeight},k={x:c.x+l.x+E.x,y:c.y+l.x+E.y};this.drawBox({origin:k,width:e.cellWidth,height:e.cellHeight,padding:1},{fillStyle:"rgba(0, 255, 0, 0.2)"})}}catch(j){p=!0,m=j}finally{try{g||null==b.return||b.return()}finally{if(p)throw m}}}}},{key:"drawArrow",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.a)({tipSize:this.size/100/this.getScale(),name:""},t);this.drawLine(Object(r.a)({},n),e);var a=this.worldToScreen(n.from),i=this.worldToScreen(n.to),o=h.a.fromObject(i).subtract(h.a.fromObject(a)).angle();this.drawDirection(Object(r.a)({},n,{center:n.to,angle:o,size:n.tipSize}),e)}},{key:"drawDirection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.a)({size:this.size/100/this.getScale(),name:""},t),a=this.worldToScreen(n.center),i=this.scale(n.size);if(this.ctx.save(),this.applyStyle(e),this.ctx.translate(a.x,a.y),this.ctx.rotate(n.angle),this.ctx.beginPath(),this.ctx.moveTo(-i/2,i/2),this.ctx.lineTo(-i/2,-i/2),this.ctx.lineTo(0,0),this.ctx.lineTo(-i/2,i/2),this.ctx.fill(),this.ctx.restore(),n.name.length>0){var o=this.toCartesian(n.center);o.x+=2*n.size,this.drawText({origin:o,text:n.name},e)}}},{key:"drawText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.a)({offset:{x:0,y:0}},t),a=this.worldToScreen(n.origin);this.ctx.save(),this.applyStyle(e),this.ctx.translate(a.x,a.y),this.ctx.rotate(-this.transform.rotation),this.ctx.scale(this.transform.horizontalScaling,this.transform.verticalScaling),this.ctx.fillText(n.text,n.offset.x,n.offset.y),this.ctx.restore()}},{key:"drawCoordinateSystem",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.screenToWorld({x:this.width,y:this.height}),n=this.size/20/this.getScale(),a=Object(r.a)({center:{x:-e.y/2+n,y:-e.x/2+n},length:n},t),i=h.a.fromObject(this.toCartesian(a.center)),o=i.clone().add(new h.a(a.length,0)),s=i.clone().add(new h.a(0,a.length));this.drawArrow({from:a.center,to:o,name:"X"},{lineWidth:2,color:"#F00",textAlign:"center"}),this.drawArrow({from:a.center,to:s,name:"Y"},{lineWidth:2,color:"#0F0",textAlign:"center"})}},{key:"drawGraph",value:function(t){var e=Object(r.a)({width:200,height:80},t),n=this.worldToScreen(e.origin),i=Math.max(e.values.length-e.width,0),o=e.values.slice(i,e.values.length),s=void 0!==t.min?t.min:Math.min.apply(Math,Object(a.a)(o)),c=void 0!==t.max?t.max:Math.max.apply(Math,Object(a.a)(o)),l=c-s;this.ctx.save(),this.ctx.translate(n.x,n.y),this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,e.width,e.height);var u=e.width;this.ctx.beginPath();for(var h=!1,d=o.length;d>=0;d--){var f=o[d],v=Math.min(Math.max(f,s),c),g=Math.abs(v-f)>.1,p=e.height-Math.round((v-s)/l*e.height);0===d?this.ctx.moveTo(u,p):this.ctx.lineTo(u,p),u--,g&&(h=!0)}this.ctx.strokeStyle=h?"rgba(200, 0, 0, 0.75)":"rgba(0, 200, 0, 0.75)",this.ctx.stroke(),this.ctx.restore(),this.drawText({origin:t.origin,text:t.name,offset:{x:10,y:10}},{fillStyle:"#FFF"})}},{key:"polarToCartesian",value:function(t){var e=t.angle,n=t.distance;return{x:n*Math.cos(e),y:n*Math.sin(e)}}},{key:"toCartesian",value:function(t){if(this.isPolar(t)){var e=Math.PI/2;return{x:t.distance*Math.cos(t.angle+e),y:t.distance*Math.sin(t.angle+e)}}return t}},{key:"worldToScreen",value:function(t){var e=this.toCartesian(t),n=e.x,a=e.y;return{x:this.scale(n),y:this.scale(a)}}},{key:"screenToWorld",value:function(t){var e=this.toCartesian(t),n=e.x,a=e.y,i=this.getScale();return{x:n/i,y:a/i}}},{key:"canvasToScreen",value:function(t){var e=h.a.fromObject(this.getScreenOrigin()),n=h.a.fromObject(t).subtract(e).rotate(this.transform.rotation).multiply(new h.a(this.transform.horizontalScaling,this.transform.verticalScaling));return{x:n.x,y:n.y}}},{key:"isPolar",value:function(t){return"number"===typeof t.angle&&"number"===typeof t.distance}},{key:"getScale",value:function(){return this.transform.scale}},{key:"scale",value:function(t){return t*this.getScale()}},{key:"toRadians",value:function(t){return t*(Math.PI/180)}},{key:"clear",value:function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.restore()}},{key:"applyStyle",value:function(t){t.color&&(this.ctx.strokeStyle=t.color,this.ctx.fillStyle=t.color),t.strokeStyle&&(this.ctx.strokeStyle=t.strokeStyle),t.fillStyle&&(this.ctx.fillStyle=t.fillStyle),t.lineWidth&&(this.ctx.lineWidth=t.lineWidth),t.font&&(this.ctx.font=t.font),t.textAlign&&(this.ctx.textAlign=t.textAlign),t.textBaseline&&(this.ctx.textBaseline=t.textBaseline)}},{key:"getScreenOrigin",value:function(){return{x:this.width/2,y:this.height/2}}},{key:"renderFrame",value:function(t){if(this.isRunning){var e=Date.now(),n=(this.lastRenderTime?e-this.lastRenderTime:16)/1e3;this.options.render({dt:n,time:t,frame:this.frameNumber++,layer:this}),this.lastRenderTime=e}}},{key:"scheduleNextFrame",value:function(){var t=this;window.requestAnimationFrame(function(e){t.isRunning&&(t.renderFrame(e),t.scheduleNextFrame())})}},{key:"handleMouseEvent",value:function(t,e){var n=this.canvasToScreen(e),a={screen:n,world:this.screenToWorld(n),isMouseDown:this.mouseDownCounter>0,event:e};switch(t){case"down":this.mouseDownCounter++,this.options.onMouseDownEvent(Object(r.a)({type:t},a));break;case"up":this.mouseDownCounter--,this.options.onMouseUpEvent(Object(r.a)({type:t},a));break;case"move":this.options.onMouseMoveEvent(Object(r.a)({type:t},a))}}}]),t}(),v=function(){function t(e){Object(o.a)(this,t),this.container=e,this.layers=[]}return Object(s.a)(t,[{key:"createLayer",value:function(t){var e=this.createCanvasElement();this.container.append(e);var n=new f(e,t);return this.layers.push(n),n}},{key:"start",value:function(){var t=!0,e=!1,n=void 0;try{for(var a,i=this.layers[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.start()}}catch(r){e=!0,n=r}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}}},{key:"stop",value:function(){var t=!0,e=!1,n=void 0;try{for(var a,i=this.layers[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.stop()}}catch(r){e=!0,n=r}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}}},{key:"createCanvasElement",value:function(){var t=document.createElement("canvas");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.right="0",t}}]),t}();n.d(e,"a",function(){return v})},55:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return g});var a=n(6),i=n(4),r=n(2),o=n(3),s=n(10),c=n(7),l=n(8),u=n(0),h=n.n(u),d=n(5),f=n(38);function v(){var t=Object(a.a)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n"]);return v=function(){return t},t}var g=function(e){function n(){var t,e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=Object(s.a)(this,(t=Object(c.a)(n)).call.apply(t,[this].concat(i)))).wrapRef=h.a.createRef(),e.visualizer=null,e}return Object(l.a)(n,e),Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;t(function(){return e.setupMap()})}},{key:"componentWillUnmount",value:function(){null!==this.visualizer&&(this.visualizer.stop(),this.visualizer=null)}},{key:"render",value:function(){return h.a.createElement(p,{ref:this.wrapRef})}},{key:"setupMap",value:function(){var t=this,e=this.wrapRef.current;if(!e)throw new Error("Wrap element was not found, this should not happen");this.visualizer=new f.a(e);var n={getTransform:function(e){var n={x:e.width/2,y:e.height/2},a=-Math.PI/2,i=e.size/2/(t.props.radius+t.props.cellSize);return{horizontalScaling:-1,verticalSkewing:0,horizontalSkewing:0,verticalScaling:1,horizontalTranslation:n.x,verticalTranslation:n.y,rotation:a,scale:i}}};this.visualizer.createLayer(Object(i.a)({},n,{render:this.renderBackground.bind(this)})),this.visualizer.createLayer(Object(i.a)({},n,{render:this.renderMap.bind(this)})),this.visualizer.start()}},{key:"renderBackground",value:function(t){var e=t.layer;if(!(t.frame>0)){var n=2*this.props.radius/this.props.cellSize,a=this.props.radius/4;e.drawGrid({cellWidth:this.props.cellSize,cellHeight:this.props.cellSize},{strokeStyle:"#222"}),e.drawGrid({rows:n,columns:n,cellWidth:this.props.cellSize,cellHeight:this.props.cellSize},{strokeStyle:"#333"});for(var i=a;i<=this.props.radius;i+=a)e.drawCircle({radius:i},{strokeStyle:"#444"}),e.drawText({origin:{x:0,y:i},text:"".concat(i.toFixed(2),"m"),offset:{x:10,y:0}},{fillStyle:"#444",textBaseline:"middle"});e.drawCoordinateSystem()}}},{key:"renderMap",value:function(t){var e=t.layer;e.clear();var n=this.props.measurements(),a=!0,i=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;e.drawMarker({center:{angle:e.toRadians(c.angle),distance:c.distance/100}},{fillStyle:"rgba(255, 255, 255, ".concat(c.quality/100,")")})}}catch(l){i=!0,r=l}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}}]),n}(h.a.Component),p=d.d.div(v())}).call(this,n(48).setImmediate)},59:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return v});var a=n(6),i=n(2),r=n(3),o=n(10),s=n(7),c=n(8),l=n(0),u=n.n(l),h=n(5),d=n(60);function f(){var t=Object(a.a)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n"]);return f=function(){return t},t}var v=function(e){function n(){var t,e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=Object(o.a)(this,(t=Object(s.a)(n)).call.apply(t,[this].concat(r)))).containerRef=u.a.createRef(),e.simulator=null,e}return Object(c.a)(n,e),Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;t(function(){return e.setup()})}},{key:"componentWillUnmount",value:function(){null!==this.simulator&&(this.simulator.stop(),this.simulator=null)}},{key:"render",value:function(){return u.a.createElement(g,{ref:this.containerRef})}},{key:"setup",value:function(){var t=this.containerRef.current;if(!t)throw new Error("Wrap element was not found, this should not happen");this.simulator=new d.a({container:t,radius:5,cellSize:.1,pathPlanningIntervalMs:100}),this.simulator.start()}}]),n}(u.a.Component),g=h.d.div(f())}).call(this,n(48).setImmediate)},60:function(t,e,n){"use strict";var a,i=n(4),r=n(2),o=n(3),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t),this.options=void 0,this.frameDurations=[],this.lastFrameTime=void 0,this.options=Object(i.a)({historySize:60,averageSize:60},e)}return Object(o.a)(t,[{key:"update",value:function(){var t=Date.now();if(this.lastFrameTime){var e=t-this.lastFrameTime;this.frameDurations.push(e),this.frameDurations.length>this.options.historySize&&this.frameDurations.shift(),this.lastFrameTime=t}else this.lastFrameTime=t}},{key:"getFps",value:function(){var t=this.frameDurations.slice(Math.max(this.frameDurations.length-this.options.averageSize,0),this.frameDurations.length);return 0===t.length?0:1e3/(t.reduce(function(t,e){return t+e},0)/t.length)}},{key:"getHistory",value:function(){return this.frameDurations}}]),t}(),c=n(16),l=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t),this.gamepads=[],this.options=void 0,this.log=void 0,this.options=Object(i.a)({log:c.dummyLogger,autoPoll:!0,onConnect:function(t){},onDisconnect:function(t){},onUpdate:function(t){}},n),this.log=this.options.log,"function"===typeof navigator.getGamepads?(window.addEventListener("gamepadconnected",function(t){var n=t.gamepad;e.log.info("gamepad #".concat(n.index,' "').concat(n.id,'" connected (').concat(n.buttons.length," buttons, ").concat(n.axes.length," axes)"));var a=new h({index:n.index,log:e.log});a.addUpdateListener(function(t){return e.options.onUpdate(t)}),e.options.autoPoll&&a.startPolling(),e.gamepads.push(a),e.options.onConnect(a)}),window.addEventListener("gamepaddisconnected",function(t){var n=t.gamepad,a=e.getGamepadByIndex(n.index);a?(e.log.info("gamepad #".concat(n.index,' "').concat(n.id,'" disconnected')),e.gamepads=e.gamepads.filter(function(t){return t!==a}),a.stopPolling(),e.options.onDisconnect(a)):e.log.warn("gamepad #".concat(n.index,' "').concat(n.id,'" disconnected but no managed gamepad with this index was found, this should not happen'))})):this.log.info("gamepads are not supported")}return Object(o.a)(t,[{key:"getGamepadByIndex",value:function(t){return this.gamepads.find(function(e){return e.index===t})}},{key:"getFirstAvailableGamepad",value:function(){return this.gamepads.length>0?this.gamepads[0]:void 0}}]),t}(),u=n(18),h=function(){function t(e){Object(r.a)(this,t),this.index=void 0,this.axes=[],this.buttons=[],this.options=void 0,this.log=void 0,this.updateListeners=[],this.isPolling=!1,this.animationFrameRequest=void 0,this.options=Object(i.a)({log:c.dummyLogger},e),this.log=this.options.log,this.index=this.options.index}return Object(o.a)(t,[{key:"addUpdateListener",value:function(t){this.updateListeners.push(t)}},{key:"removeUpdateListener",value:function(t){this.updateListeners=this.updateListeners.filter(function(e){return e!==t})}},{key:"startPolling",value:function(){var t=this;this.isPolling||this.log.info("starting polling of gamepad #".concat(this.index)),this.isPolling=!0,this.animationFrameRequest=requestAnimationFrame(function(){t.animationFrameRequest=void 0,t.poll(),t.isPolling&&t.startPolling()})}},{key:"stopPolling",value:function(){this.isPolling&&(this.isPolling=!1,this.log.info("stopping polling of gamepad #".concat(this.index)),void 0!==this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest))}},{key:"getState",value:function(){var t=navigator.getGamepads()[this.index];if(void 0!==t&&null!==t)return t}},{key:"poll",value:function(){var t=this.getState();if(!t)return this.log.warn("attempted to poll gamepad #".concat(this.index," but the gamepad could not be found")),void(this.isPolling&&this.stopPolling());this.axes=Object(u.a)(t.axes),this.buttons=Object(u.a)(t.buttons);var e=!0,n=!1,a=void 0;try{for(var i,r=this.updateListeners[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){(0,i.value)(this)}}catch(o){n=!0,a=o}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}}}]),t}(),d=n(26),f=function(){function t(e,n){Object(r.a)(this,t),this.data=e,this.options=void 0,this.options=Object(i.a)({},n)}return Object(o.a)(t,[{key:"setOccupancy",value:function(t){var e=t.row,n=t.column,a=t.occupancy;this.data[e][n]=a}},{key:"setOccupancyAt",value:function(t){var e=t.center,n=t.occupancy,a=this.getCellAtCoordinates(e),i=a.row,r=a.column;a.exists&&this.setOccupancy({row:i,column:r,occupancy:n})}},{key:"getOccupancyAt",value:function(t){var e=this.getCellAtCoordinates(t),n=e.row,a=e.column;if(e.exists)return this.getOccupancy(n,a)}},{key:"getOccupancy",value:function(t,e){if(void 0!==this.data[t]&&void 0!==this.data[t][e])return this.data[t][e]}},{key:"getCellAtCoordinates",value:function(t){var e=this.getSize(),n=e.rows,a=e.columns,i=e.width,r=e.height,o=t.x+i/2,s=t.y+r/2,c=Math.floor(s/this.options.cellHeight),l=Math.floor(o/this.options.cellWidth);return{row:c,column:l,exists:c>=0&&c<n&&l>=0&&l<a}}},{key:"getSize",value:function(){var t=this.data.length,e=this.data.length>0?this.data[0].length:0;return{rows:t,columns:e,width:t*this.options.cellWidth,height:e*this.options.cellHeight}}},{key:"findShortestPath",value:function(t){var e=t.from,n=t.to,a=new d.Grid(this.data);return new d.AStarFinder({diagonalMovement:d.DiagonalMovement.Never,heuristic:d.Heuristic.euclidean}).findPath(e[0],e[1],n[0],n[1],a)}}],[{key:"generate",value:function(e,n){for(var a=e.rows,i=e.columns,r=e.defaultValue,o=[],s=0;s<a;s++)o[s]=Array(i).fill(r);return new t(o,n)}}]),t}(),v=function(){function t(e){Object(r.a)(this,t),this.options=e,this.values=[]}return Object(o.a)(t,[{key:"report",value:function(t){var e=this.options.historyLength||200;this.values.push(t),this.values.length>e&&this.values.shift()}},{key:"getLatest",value:function(){return 0===this.values.length?0:this.values[this.values.length-1]}}]),t}(),g=function(){function t(){Object(r.a)(this,t),this.statistics=[]}return Object(o.a)(t,[{key:"create",value:function(t){var e=new v(t);this.statistics.push(e)}},{key:"getByName",value:function(t){return this.statistics.find(function(e){return e.options.name===t})}},{key:"report",value:function(t,e){var n=this.getByName(t);if(!n)throw new Error('Statistic called "'.concat(t,'" could not be found'));return n.report(e),n}}]),t}(),p=n(38);!function(t){t.FPS="FPS",t.PATH_FINDER="Path finder"}(a||(a={}));var m=function(){function t(e){var n=this;Object(r.a)(this,t),this.options=e,this.occupancyGrid=void 0,this.fpsCounter=void 0,this.statistics=void 0,this.gamepadManager=void 0,this.visualizer=void 0,this.gamepad=void 0,this.pulses=[],this.gridModificationMode=0,this.lastPathPlanningTime=0,this.path=[];var o=2*e.radius/e.cellSize;this.occupancyGrid=f.generate({rows:o,columns:o,defaultValue:0},{cellWidth:e.cellSize,cellHeight:e.cellSize}),this.fpsCounter=new s,this.statistics=new g,this.gamepadManager=new l({log:console,onConnect:function(t){console.log("GOT GAMEPAD",t,n.gamepadManager.gamepads),n.gamepad=n.gamepadManager.getFirstAvailableGamepad()},onDisconnect:function(t){console.log("LOST GAMEPAD",t,n.gamepadManager.gamepads),n.gamepad=n.gamepadManager.getFirstAvailableGamepad()},onUpdate:function(t){t.axes.forEach(function(e,a){var i="Gamepad #".concat(t.index,".").concat(a);n.statistics.getByName(i)||n.statistics.create({name:i,min:-1,max:1,decimalPlaces:2}),n.statistics.report(i,e)})}}),this.visualizer=new p.a(this.options.container);var c={defaultStyle:{fillStyle:"#000",strokeStyle:"#000",font:"16px roboto-mono-light",textBaseline:"top"},getTransform:function(t){var n={x:t.width/2,y:t.height/2},a=-Math.PI/2,i=t.size/2/(e.radius+e.cellSize);return{horizontalScaling:-1,verticalSkewing:0,horizontalSkewing:0,verticalScaling:1,horizontalTranslation:n.x,verticalTranslation:n.y,rotation:a,scale:i}}};this.visualizer.createLayer(Object(i.a)({},c,{render:this.renderBackground.bind(this)})),this.visualizer.createLayer(Object(i.a)({},c,{render:this.renderMap.bind(this),onMouseDownEvent:this.onMouseDown.bind(this),onMouseUpEvent:this.onMouseUp.bind(this),onMouseMoveEvent:this.onMouseMove.bind(this)})),this.visualizer.createLayer({defaultStyle:{fillStyle:"#000",strokeStyle:"#000",font:"16px roboto-mono-light",textBaseline:"top"},render:this.renderForeground.bind(this)}),this.statistics.create({name:a.FPS,min:0,max:62}),this.statistics.create({name:a.PATH_FINDER,unit:"ms",min:0,max:100})}return Object(o.a)(t,[{key:"start",value:function(){this.visualizer.start()}},{key:"stop",value:function(){this.visualizer.stop()}},{key:"renderBackground",value:function(t){var e=t.layer;if(!(t.frame>0)){var n=this.options.cellSize,a=this.options.cellSize,i=2*this.options.radius/this.options.cellSize,r=this.options.radius/4;e.drawGrid({cellWidth:n,cellHeight:a,columns:2*Math.ceil(e.height/e.getScale()/n/2),rows:2*Math.ceil(e.width/e.getScale()/a/2),centered:!0},{strokeStyle:"#222"}),e.drawGrid({rows:i,columns:i,cellWidth:n,cellHeight:a,centered:!0},{strokeStyle:"#333"});for(var o=r;o<=this.options.radius;o+=r)e.drawCircle({radius:o},{strokeStyle:"#444"}),e.drawText({origin:{x:0,y:o},text:"".concat(o.toFixed(2),"m"),offset:{x:10,y:0}},{fillStyle:"#444",textBaseline:"middle"});e.drawCoordinateSystem()}}},{key:"renderMap",value:function(t){var e=t.layer;e.clear();var n=Date.now();if(n-this.lastPathPlanningTime>this.options.pathPlanningIntervalMs){var i=Date.now();this.path=this.occupancyGrid.findShortestPath({from:[0,0],to:[this.occupancyGrid.data.length-1,this.occupancyGrid.data[0].length-1]});var r=Date.now()-i;this.statistics.report(a.PATH_FINDER,r),this.lastPathPlanningTime=n}e.drawOccupancyGrid({grid:this.occupancyGrid.data,path:this.path,cellWidth:this.options.cellSize,cellHeight:this.options.cellSize,centered:!0}),this.drawPulses(e),this.fpsCounter.update()}},{key:"renderForeground",value:function(t){var e=t.layer;e.clear();var n=this.fpsCounter.getFps();this.statistics.report(a.FPS,n),this.statistics.statistics.forEach(function(t,n){e.drawGraph({name:"".concat(t.options.name,": ").concat(t.getLatest().toFixed(t.options.decimalPlaces||0)).concat(t.options.unit||""),origin:{x:10,y:30+80*n},min:t.options.min,max:t.options.max,values:t.values})});var i=!0,r=!1,o=void 0;try{for(var s,c=this.gamepadManager.gamepads[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value,u=[l.buttons.reduce(function(t,e){return t.push(e.value),t},[])],h=200/l.buttons.length,d={x:10,y:10};e.drawGrid({origin:d,rows:1,columns:l.buttons.length,cellWidth:h,cellHeight:h},{strokeStyle:"#111"}),e.drawOccupancyGrid({grid:u,origin:d,cellWidth:h,cellHeight:h})}}catch(f){r=!0,o=f}finally{try{i||null==c.return||c.return()}finally{if(r)throw o}}}},{key:"drawPulses",value:function(t){var e=Date.now();this.pulses=this.pulses.filter(function(t){var n=t.time;return e-n<250}),this.pulses.forEach(function(n){var a=n.x,i=n.y,r=n.time;return t.drawPulse({center:{x:a,y:i},lifetime:250,age:e-r},{fillStyle:"#0F0"})})}},{key:"onMouseDown",value:function(t){var e=t.world,n=this.occupancyGrid.getOccupancyAt(e);void 0!==n&&(0===this.gridModificationMode&&(this.gridModificationMode=0===n?1:-1),this.occupancyGrid.setOccupancyAt({center:e,occupancy:1===n?0:1}),this.pulses.push(Object(i.a)({},e,{time:Date.now()})))}},{key:"onMouseUp",value:function(t){this.gridModificationMode=0}},{key:"onMouseMove",value:function(t){var e=t.world,n=t.isMouseDown,a=t.event;if(n&&0===a.button){if(0===this.gridModificationMode){var i=this.occupancyGrid.getOccupancyAt(e);this.gridModificationMode=0===i?1:-1}this.occupancyGrid.setOccupancyAt({center:e,occupancy:1===this.gridModificationMode?1:0})}}}]),t}();n.d(e,"a",function(){return m})},65:function(t,e,n){t.exports=n(107)}},[[65,1,2]]]);
//# sourceMappingURL=main.11d018df.chunk.js.map