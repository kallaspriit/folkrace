{"version":3,"sources":["lib/web-socket-client/index.ts","containers/LogContainer.ts","config.ts","containers/StatusContainer.ts","services/webSocketClient.ts","services/robot.ts","lib/robot/index.ts","command-handlers/serial.ts","command-handlers/get-voltage.ts","command-handlers/ip.ts","command-handlers/usb.ts","containers/OdometryContainer.ts","command-handlers/e.ts","components/glue/ConnectionManager.tsx","components/main-menu/MainMenu.tsx","views/bot/BotView.tsx","components/grid/Grid.tsx","views/map/MapView.tsx","components/joystick/Joystick.tsx","lib/tracked-vehicle-kinematics/index.ts","lib/remote-controller/index.ts","views/remote/RemoteView.tsx","views/settings/SettingsView.tsx","components/icon/Icon.tsx","services/pad.ts","views/status/StatusView.tsx","services/assertUnreachable.ts","services/formatTime.ts","App.tsx","index.tsx"],"names":["WebSocketState","LogContainer","state","entries","lastId","message","_this2","this","avoidDuplicate","arguments","length","undefined","setState","previousState","lastEntryMessage","Object","toConsumableArray","slice","concat","objectSpread","time","Date","id","toString","shift","catch","error","console","Container","config","webSocket","host","localStorage","webSocketHost","port","webSocketPort","parseInt","useSSL","reconnectInterval","rules","battery","low","critical","vehicle","trackWidth","maxSpeed","wheelDiameter","encoderCountsPerRotation","gearboxRatio","speedUpdateInterval","SerialType","SerialState","BatteryState","WebSocketClient","options","classCallCheck","connectionState","DISCONNECTED","listeners","wasConnected","log","dummyLogger","url","ws","connect","listener","push","filter","item","_this","addNewLine","CONNECTED","forEach","onSendMessage","send","warn","newState","oldState","onStateChanged","_this3","info","RECONNECTING","CONNECTING","onConnecting","WebSocket","onopen","event","onOpen","onclose","logDetails","code","reason","wasClean","setTimeout","onClose","onerror","onError","onmessage","onMessage","data","StatusContainer","serials","BLUETOOTH","type","deviceName","USB","webSocketState","typeKey","keys","find","typeName","batteryVoltage","remoteIp","map","serialName","serial","voltage","UNKNOWN","CRITICAL","LOW","FULL","webSocketClient","robot","Robot","handleSerialCommand","args","_ref","statusContainer","serialType","serialState","serialDeviceName","setSerialState","getConnectedSerial","requestVoltage","setBatteryVoltage","handleGetVoltageCommand","parseFloat","handleIpCommand","setRemoteIp","handleUsbCommand","objectDestructuringEmpty","OdometryContainer","left","right","handleECommand","odometryContainer","update","ConnectionManager","isInitialized","webSocketCommandHandlers","get-voltage","ip","usb","e","react","unstated_es","to","logContainer","setWebSocketState","subscribe","_ws","_wasConnected","addEntry","_event","handleWebSocketMessage","_oldState","containers","_message$split","split","_message$split2","toArray","name","handleWebSocketCommand","handler","join","React","MainMenu","className","NavLink","activeClassName","BotView","Grid","children","classNames","GridItem","_React$Component","_getPrototypeOf2","_len","Array","_key","possibleConstructorReturn","getPrototypeOf","call","apply","ref","inherits","createClass","key","value","props","scrollToBottom","el","current","scrollHeight","clientHeight","scrollTop","MapView","Grid_Grid","Grid_GridItem","Joystick","manager","nipplejs","zone","color","size","position","top","mode","onEvent","bind","on","nipple","off","TrackedVehicleKinematics","speed","omega","limit","targetEncoderCountPerSecond","Math","PI","floor","speeds","maxRequestedSpeedMagnitude","max","abs","normalizationFactor","min","getSpeedEncoderCount","RemoteController","kinematics","scheduleUpdateMotorSpeeds","throttle","updateMotorSpeeds","motorSpeeds","calculateMotorSpeeds","encoderSpeeds","getEncoderSpeeds","RemoteView","remoteController","Joystick_Joystick","onJoystickEvent","indexOf","isMoveEvent","xPos","sin","angle","radian","distance","yPos","cos","setSpeed","setOmega","Error","SettingsView","onClick","window","location","href","Icon","width","height","style","getStyle","pad","padder","str","missingLength","StatusView","connectedSerial","titleCase","batteryState","assertUnreachable","getBatteryLevelClass","toFixed","entry","date","getHours","getMinutes","getSeconds","getMilliseconds","clear","icon_Icon","App","ConnectionManager_ConnectionManager","BrowserRouter","Switch","Route","path","component","exact","Redirect","components_main_menu_MainMenu","ReactDOM","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.265ee6a6.chunk.js","sourcesContent":["import { dummyLogger, Logger } from \"ts-log\";\r\n\r\nexport interface WebSocketClientListener {\r\n  onConnecting(ws: WebSocketClient, wasConnected: boolean): void;\r\n  onOpen(ws: WebSocketClient, event: Event): void;\r\n  onClose(ws: WebSocketClient, event: CloseEvent, wasConnected: boolean): void;\r\n  onError(ws: WebSocketClient, event: Event, wasConnected: boolean): void;\r\n  onMessage(ws: WebSocketClient, message: string): void;\r\n  onStateChanged(\r\n    ws: WebSocketClient,\r\n    newState: WebSocketState,\r\n    oldState: WebSocketState\r\n  ): void;\r\n  onSendMessage(ws: WebSocketClient, e: string): void;\r\n}\r\n\r\nexport interface WebSocketClientOptions {\r\n  host: string;\r\n  port: number;\r\n  useSSL?: boolean;\r\n  reconnectInterval?: number;\r\n  log?: Logger;\r\n}\r\n\r\nexport enum WebSocketState {\r\n  DISCONNECTED = \"DISCONNECTED\",\r\n  CONNECTING = \"CONNECTING\",\r\n  RECONNECTING = \"RECONNECTING\",\r\n  CONNECTED = \"CONNECTED\"\r\n}\r\n\r\nexport default class WebSocketClient {\r\n  private connectionState: WebSocketState = WebSocketState.DISCONNECTED;\r\n  private listeners: WebSocketClientListener[] = [];\r\n  private ws: WebSocket;\r\n  private readonly options: Required<WebSocketClientOptions>;\r\n  private readonly log: Logger;\r\n  private wasConnected = false;\r\n\r\n  constructor(options: WebSocketClientOptions) {\r\n    this.options = {\r\n      useSSL: false,\r\n      log: dummyLogger,\r\n      reconnectInterval: 1000,\r\n      ...options\r\n    };\r\n    this.log = this.options.log;\r\n\r\n    const url = `${this.options.useSSL ? \"wss\" : \"ws\"}://${this.options.host}:${\r\n      this.options.port\r\n    }`;\r\n\r\n    this.ws = this.connect(url);\r\n  }\r\n\r\n  subscribe(listener: WebSocketClientListener) {\r\n    this.listeners.push(listener);\r\n  }\r\n\r\n  unsubscribe(listener: WebSocketClientListener) {\r\n    this.listeners = this.listeners.filter(item => item !== listener);\r\n  }\r\n\r\n  get state() {\r\n    return this.connectionState;\r\n  }\r\n\r\n  send(message: string, addNewLine = true) {\r\n    // we can only send messages if we're connected\r\n    if (this.state !== WebSocketState.CONNECTED) {\r\n      this.log.warn(\r\n        `sending message \"${message}\" requested but web-socket is ${\r\n          this.connectionState\r\n        }`\r\n      );\r\n\r\n      return;\r\n    }\r\n\r\n    // notify the listeners\r\n    this.listeners.forEach(listener => listener.onSendMessage(this, message));\r\n\r\n    // send the message\r\n    this.ws.send(`${message}${addNewLine ? \"\\n\" : \"\"}`);\r\n  }\r\n\r\n  private setState(newState: WebSocketState) {\r\n    // return if state has not changed\r\n    if (newState === this.connectionState) {\r\n      return;\r\n    }\r\n\r\n    const oldState = this.connectionState;\r\n\r\n    this.connectionState = newState;\r\n\r\n    // notify the listeners\r\n    this.listeners.forEach(listener =>\r\n      listener.onStateChanged(this, newState, oldState)\r\n    );\r\n  }\r\n\r\n  private connect(url: string): WebSocket {\r\n    this.log.info(`connecting to web-socket server at ${url}`);\r\n\r\n    // update state\r\n    this.setState(\r\n      this.wasConnected\r\n        ? WebSocketState.RECONNECTING\r\n        : WebSocketState.CONNECTING\r\n    );\r\n\r\n    // notify the listeners\r\n    this.listeners.forEach(listener =>\r\n      listener.onConnecting(this, this.wasConnected)\r\n    );\r\n\r\n    // attempt to open web-socket connection\r\n    this.ws = new WebSocket(url);\r\n\r\n    // handle open event\r\n    this.ws.onopen = event => {\r\n      this.log.info(\"established web-socket connection\");\r\n\r\n      this.wasConnected = true;\r\n\r\n      // update state\r\n      this.setState(WebSocketState.CONNECTED);\r\n\r\n      // notify the listeners\r\n      this.listeners.forEach(listener => listener.onOpen(this, event));\r\n    };\r\n\r\n    // handle close event\r\n    this.ws.onclose = event => {\r\n      const logDetails = `code: ${event.code}, reason: ${\r\n        event.reason\r\n      }, was clean: ${event.wasClean ? \"yes\" : \"no\"}`;\r\n\r\n      if (this.wasConnected) {\r\n        this.log.warn(`connection to web-socket was lost (${logDetails})`);\r\n      } else {\r\n        this.log.warn(`connecting to web-socket failed (${logDetails})`);\r\n      }\r\n\r\n      // update state\r\n      this.setState(WebSocketState.DISCONNECTED);\r\n\r\n      // attempt to reconnect\r\n      setTimeout(() => {\r\n        this.ws = this.connect(url);\r\n      }, this.options.reconnectInterval);\r\n\r\n      // notify the listeners\r\n      this.listeners.forEach(listener =>\r\n        listener.onClose(this, event, this.wasConnected)\r\n      );\r\n    };\r\n\r\n    // handle error event\r\n    this.ws.onerror = event => {\r\n      this.log.warn(\"got web-socket error\");\r\n\r\n      // notify the listeners\r\n      this.listeners.forEach(listener =>\r\n        listener.onError(this, event, this.wasConnected)\r\n      );\r\n    };\r\n\r\n    // handle message event\r\n    this.ws.onmessage = event => {\r\n      // notify the listeners\r\n      this.listeners.forEach(listener => listener.onMessage(this, event.data));\r\n    };\r\n\r\n    return this.ws;\r\n  }\r\n}\r\n","import { Container } from \"unstated\";\r\n\r\nexport interface LogEntry {\r\n  id: string;\r\n  time: Date;\r\n  message: string;\r\n}\r\n\r\nexport interface LogState {\r\n  entries: LogEntry[];\r\n}\r\n\r\nexport const MAX_LOG_ENTRY_COUNT = 200;\r\n\r\nexport default class LogContainer extends Container<LogState> {\r\n  readonly state: LogState = {\r\n    entries: []\r\n  };\r\n\r\n  private lastId = 0;\r\n\r\n  addEntry(message: string, avoidDuplicate = true) {\r\n    // update state (use the callback syntax not to miss any updates if called in series)\r\n    this.setState(previousState => {\r\n      const lastEntryMessage =\r\n        this.state.entries.length > 0\r\n          ? this.state.entries[this.state.entries.length - 1]\r\n          : null;\r\n\r\n      // skip the message if requested not to add the same message twice in a row\r\n      if (\r\n        lastEntryMessage !== null &&\r\n        message === lastEntryMessage.message &&\r\n        avoidDuplicate\r\n      ) {\r\n        // update the last entry time\r\n        const updatedEntries: LogEntry[] = [\r\n          ...previousState.entries.slice(0, this.state.entries.length - 1), // remove last\r\n          {\r\n            ...lastEntryMessage,\r\n            time: new Date()\r\n          }\r\n        ];\r\n\r\n        return {\r\n          entries: updatedEntries\r\n        };\r\n      }\r\n\r\n      // appends the log entry\r\n      const entries: LogEntry[] = [\r\n        ...previousState.entries,\r\n        {\r\n          id: (this.lastId++).toString(),\r\n          time: new Date(),\r\n          message\r\n        }\r\n      ];\r\n\r\n      // limit the number of entries\r\n      while (entries.length > MAX_LOG_ENTRY_COUNT) {\r\n        entries.shift();\r\n      }\r\n\r\n      return {\r\n        entries\r\n      };\r\n    }).catch(error => console.error(error));\r\n  }\r\n\r\n  clear() {\r\n    this.setState({\r\n      entries: []\r\n    }).catch(error => console.error(error));\r\n  }\r\n}\r\n","import { WebSocketClientOptions } from \"./lib/web-socket-client/index\";\r\nimport { TrackedVehicleOptions } from \"./lib/tracked-vehicle-kinematics\";\r\n\r\nexport interface RulesConfig {\r\n  battery: {\r\n    low: number;\r\n    critical: number;\r\n  };\r\n}\r\n\r\nexport interface Config {\r\n  webSocket: WebSocketClientOptions;\r\n  rules: RulesConfig;\r\n  vehicle: TrackedVehicleOptions;\r\n}\r\n\r\nconst config: Config = {\r\n  webSocket: {\r\n    // allow overriding web-socket options via local storage\r\n    host:\r\n      localStorage.webSocketHost !== undefined\r\n        ? localStorage.webSocketHost\r\n        : \"127.0.0.1\",\r\n    port:\r\n      localStorage.webSocketPort !== undefined\r\n        ? parseInt(localStorage.webSocketPort, 10)\r\n        : 8000,\r\n    useSSL: false,\r\n    reconnectInterval: 3000\r\n  },\r\n  rules: {\r\n    battery: {\r\n      low: 15.0,\r\n      critical: 13.5\r\n    }\r\n  },\r\n  vehicle: {\r\n    trackWidth: 0.15, // meters\r\n    maxSpeed: 1, // meters per second\r\n    wheelDiameter: 0.039, // meters\r\n    encoderCountsPerRotation: 20, // encoder pulse count per revolution\r\n    gearboxRatio: 25, // 25/1 gearbox ratio\r\n    speedUpdateInterval: 50 // 20Hz\r\n  }\r\n};\r\n\r\nexport default config;\r\n","import { Container } from \"unstated\";\r\n\r\nimport config from \"../config\";\r\nimport { WebSocketState } from \"../lib/web-socket-client/index\";\r\n\r\nexport enum SerialType {\r\n  USB = \"usb\",\r\n  BLUETOOTH = \"bluetooth\"\r\n}\r\n\r\nexport enum SerialState {\r\n  CONNECTING = \"CONNECTING\",\r\n  CONNECTED = \"CONNECTED\",\r\n  DISCONNECTED = \"DISCONNECTED\",\r\n  NOT_SUPPORTED = \"NOT_SUPPORTED\",\r\n  DEVICE_NOT_FOUND = \"DEVICE_NOT_FOUND\",\r\n  DISABLED = \"DISABLED\"\r\n}\r\n\r\nexport interface Serial {\r\n  type: SerialType;\r\n  state: SerialState;\r\n  deviceName?: string;\r\n}\r\n\r\nexport type SerialsMap = { [type in keyof typeof SerialType]: Serial };\r\n\r\nexport interface State {\r\n  readonly webSocketState: WebSocketState;\r\n  readonly serials: SerialsMap;\r\n  readonly batteryVoltage?: number;\r\n  readonly remoteIp?: string;\r\n}\r\n\r\nexport enum BatteryState {\r\n  UNKNOWN = \"UNKNOWN\",\r\n  FULL = \"FULL\",\r\n  LOW = \"LOW\",\r\n  CRITICAL = \"CRITICAL\"\r\n}\r\n\r\nexport default class StatusContainer extends Container<State> {\r\n  readonly state: State = {\r\n    serials: {\r\n      BLUETOOTH: {\r\n        type: SerialType.BLUETOOTH,\r\n        state: SerialState.DISCONNECTED,\r\n        deviceName: undefined\r\n      },\r\n      USB: {\r\n        type: SerialType.USB,\r\n        state: SerialState.DISCONNECTED,\r\n        deviceName: undefined\r\n      }\r\n    },\r\n    webSocketState: WebSocketState.DISCONNECTED\r\n  };\r\n\r\n  setSerialState(type: SerialType, state: SerialState, deviceName?: string) {\r\n    const typeKey = Object.keys(SerialType).find(\r\n      typeName => SerialType[typeName as keyof typeof SerialType] === type\r\n    ) as keyof typeof SerialType;\r\n    const serials = this.state.serials;\r\n\r\n    // update given serial state and status\r\n    serials[typeKey].state = state;\r\n    serials[typeKey].deviceName = deviceName;\r\n\r\n    // update serial state\r\n    void this.setState({\r\n      serials\r\n    });\r\n  }\r\n\r\n  setWebSocketState(newState: WebSocketState) {\r\n    void this.setState({\r\n      webSocketState: newState\r\n    });\r\n  }\r\n\r\n  setBatteryVoltage(batteryVoltage: number | undefined) {\r\n    void this.setState({\r\n      batteryVoltage\r\n    });\r\n  }\r\n\r\n  setRemoteIp(remoteIp: string) {\r\n    void this.setState({\r\n      remoteIp\r\n    });\r\n  }\r\n\r\n  getConnectedSerial(): Serial | undefined {\r\n    const serialNames = Object.keys(\r\n      this.state.serials\r\n    ) as (keyof typeof SerialType)[];\r\n    const connectedSerial = serialNames\r\n      .map(serialName => this.state.serials[serialName])\r\n      .find(serial => serial.state === SerialState.CONNECTED);\r\n\r\n    return connectedSerial;\r\n  }\r\n\r\n  get batteryState(): BatteryState {\r\n    const voltage = this.state.batteryVoltage;\r\n\r\n    if (voltage === undefined) {\r\n      return BatteryState.UNKNOWN;\r\n    }\r\n\r\n    if (voltage <= config.rules.battery.critical) {\r\n      return BatteryState.CRITICAL;\r\n    } else if (voltage <= config.rules.battery.low) {\r\n      return BatteryState.LOW;\r\n    }\r\n\r\n    return BatteryState.FULL;\r\n  }\r\n}\r\n","import config from \"../config\";\r\nimport WebSocketClient from \"../lib/web-socket-client\";\r\n\r\nconst webSocketClient = new WebSocketClient({\r\n  ...config.webSocket,\r\n  log: console\r\n});\r\n\r\nexport default webSocketClient;\r\n","import Robot from \"../lib/robot\";\r\nimport webSocketClient from \"./webSocketClient\";\r\n\r\nconst robot = new Robot(webSocketClient);\r\n\r\nexport default robot;\r\n","import WebSocketClient from \"../web-socket-client\";\r\n\r\nexport default class Robot {\r\n  constructor(private webSocketClient: WebSocketClient) {}\r\n\r\n  requestVoltage() {\r\n    this.webSocketClient.send(\"get-voltage\");\r\n  }\r\n}\r\n","import { ContainerMap } from \"../components/glue/ConnectionManager\";\r\nimport { SerialType, SerialState } from \"../containers/StatusContainer\";\r\nimport robot from \"../services/robot\";\r\n\r\nexport default function handleSerialCommand(\r\n  args: string[],\r\n  { statusContainer }: ContainerMap\r\n) {\r\n  // extract serial info\r\n  const serialType = args[0] as SerialType;\r\n  const serialState = args[1] as SerialState;\r\n  const serialDeviceName = typeof args[2] === \"string\" ? args[2] : undefined;\r\n\r\n  // update serial state\r\n  statusContainer.setSerialState(serialType, serialState, serialDeviceName);\r\n\r\n  const connectedSerial = statusContainer.getConnectedSerial();\r\n\r\n  // ask for some initial state info once a serial connection is established\r\n  if (connectedSerial !== undefined) {\r\n    // request current voltage\r\n    robot.requestVoltage();\r\n\r\n    // also setup an interval to ask the voltage level periodically\r\n    // requestBatteryVoltageInterval = window.setInterval(() => {\r\n    //   requestVoltage();\r\n    // }, REQUEST_BATTERY_VOLTAGE_INTERVAL);\r\n  } else {\r\n    // clear the battery voltage interval if exists\r\n    // if (requestBatteryVoltageInterval !== null) {\r\n    //   window.clearInterval(requestBatteryVoltageInterval);\r\n\r\n    //   requestBatteryVoltageInterval = null;\r\n    // }\r\n\r\n    // no serial connection so we can't be sure of battery voltage\r\n    statusContainer.setBatteryVoltage(undefined);\r\n  }\r\n}\r\n","import { ContainerMap } from \"../components/glue/ConnectionManager\";\r\n\r\nexport default function handleGetVoltageCommand(\r\n  args: string[],\r\n  { statusContainer }: ContainerMap\r\n) {\r\n  const voltage = parseFloat(args[0]);\r\n\r\n  statusContainer.setBatteryVoltage(voltage);\r\n}\r\n","import { ContainerMap } from \"../components/glue/ConnectionManager\";\r\n\r\nexport default function handleIpCommand(\r\n  args: string[],\r\n  { statusContainer }: ContainerMap\r\n) {\r\n  const remoteIp = args[0];\r\n\r\n  statusContainer.setRemoteIp(remoteIp);\r\n}\r\n","import { ContainerMap } from \"../components/glue/ConnectionManager\";\r\n\r\nexport default function handleUsbCommand(args: string[], {  }: ContainerMap) {\r\n  const vendorId = parseInt(args[0], 10);\r\n  const productId = parseInt(args[1], 10);\r\n  const productName = args[2];\r\n\r\n  // console.log(\"usb\", {\r\n  //   vendorId,\r\n  //   productId,\r\n  //   productName\r\n  // });\r\n}\r\n","import { Container } from \"unstated\";\r\n\r\nexport interface State {\r\n  readonly left: number;\r\n  readonly right: number;\r\n}\r\n\r\nexport default class OdometryContainer extends Container<State> {\r\n  readonly state: State = {\r\n    left: 0,\r\n    right: 0\r\n  };\r\n\r\n  update(left: number, right: number) {\r\n    void this.setState({\r\n      left,\r\n      right\r\n    });\r\n  }\r\n}\r\n","import { ContainerMap } from \"../components/glue/ConnectionManager\";\r\n\r\nexport default function handleECommand(\r\n  args: string[],\r\n  { odometryContainer }: ContainerMap\r\n) {\r\n  const left = parseInt(args[0], 10);\r\n  const right = parseInt(args[1], 10);\r\n\r\n  odometryContainer.update(left, right);\r\n}\r\n","import * as React from \"react\";\r\nimport { Subscribe } from \"unstated\";\r\n\r\nimport LogContainer from \"../../containers/LogContainer\";\r\nimport StatusContainer, {\r\n  SerialState,\r\n  SerialType\r\n} from \"../../containers/StatusContainer\";\r\nimport { WebSocketState } from \"../../lib/web-socket-client/index\";\r\nimport webSocketClient from \"../../services/webSocketClient\";\r\nimport handleSerialCommand from \"../../command-handlers/serial\";\r\nimport handleGetVoltageCommand from \"../../command-handlers/get-voltage\";\r\nimport handleIpCommand from \"../../command-handlers/ip\";\r\nimport handleUsbCommand from \"../../command-handlers/usb\";\r\nimport OdometryContainer from \"../../containers/OdometryContainer\";\r\nimport handleECommand from \"../../command-handlers/e\";\r\n\r\nexport interface ContainerMap {\r\n  logContainer: LogContainer;\r\n  statusContainer: StatusContainer;\r\n  odometryContainer: OdometryContainer;\r\n}\r\n\r\nexport type WebSocketCommandHandlerFn = (\r\n  args: string[],\r\n  containers: ContainerMap\r\n) => void;\r\n\r\nexport interface WebSocketCommandHandlersMap {\r\n  [x: string]: WebSocketCommandHandlerFn | undefined;\r\n}\r\n\r\n// connection manager component, connects external data to containers, does not render anything visual\r\nexport default class ConnectionManager extends React.Component {\r\n  private isInitialized = false;\r\n  private webSocketCommandHandlers: WebSocketCommandHandlersMap = {\r\n    serial: handleSerialCommand,\r\n    \"get-voltage\": handleGetVoltageCommand,\r\n    ip: handleIpCommand,\r\n    usb: handleUsbCommand,\r\n    e: handleECommand\r\n\r\n    // TODO: handle \"set-speed\"\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <Subscribe to={[LogContainer, StatusContainer, OdometryContainer]}>\r\n        {(\r\n          logContainer: LogContainer,\r\n          statusContainer: StatusContainer,\r\n          odometryContainer: OdometryContainer\r\n        ) => {\r\n          // return if already set up\r\n          if (this.isInitialized) {\r\n            return null;\r\n          }\r\n\r\n          // set initial state\r\n          statusContainer.setWebSocketState(webSocketClient.state);\r\n\r\n          // subscribe to web-socket events\r\n          webSocketClient.subscribe({\r\n            onConnecting: (_ws, _wasConnected) => {\r\n              logContainer.addEntry(\"# web-socket connecting..\");\r\n            },\r\n            onOpen: (_ws, _event) => {\r\n              logContainer.addEntry(\"# web-socket connection established\");\r\n            },\r\n            onClose: (_ws, _event, wasConnected) => {\r\n              if (wasConnected) {\r\n                logContainer.addEntry(\"# web-socket connection was lost\");\r\n              } else {\r\n                logContainer.addEntry(\r\n                  \"# establishing web-socket connection failed\"\r\n                );\r\n              }\r\n            },\r\n            onError: (_ws, _event, _wasConnected) => {\r\n              logContainer.addEntry(\"# get web-socket error\");\r\n            },\r\n            onMessage: (_ws, message) => {\r\n              // handle the message\r\n              this.handleWebSocketMessage(message, {\r\n                logContainer,\r\n                statusContainer,\r\n                odometryContainer\r\n              });\r\n            },\r\n            onStateChanged: (_ws, newState, _oldState) => {\r\n              statusContainer.setWebSocketState(newState);\r\n\r\n              // also reset other statuses if web-socket connection is lost\r\n              if (newState === WebSocketState.DISCONNECTED) {\r\n                statusContainer.setSerialState(\r\n                  SerialType.BLUETOOTH,\r\n                  SerialState.DISCONNECTED\r\n                );\r\n                statusContainer.setSerialState(\r\n                  SerialType.USB,\r\n                  SerialState.DISCONNECTED\r\n                );\r\n                statusContainer.setBatteryVoltage(undefined);\r\n              }\r\n            },\r\n            onSendMessage: (_ws, message) => {\r\n              logContainer.addEntry(`> ${message}`);\r\n            }\r\n          });\r\n\r\n          // don't run this logic again\r\n          this.isInitialized = true;\r\n\r\n          // don't render anything\r\n          return null;\r\n        }}\r\n      </Subscribe>\r\n    );\r\n  }\r\n\r\n  // handles web-socket messages\r\n  private handleWebSocketMessage(message: string, containers: ContainerMap) {\r\n    // ignore empty messages\r\n    if (message.length === 0) {\r\n      return;\r\n    }\r\n\r\n    // log the message\r\n    // TODO: let the command handlers only log what's interesting?\r\n    containers.logContainer.addEntry(`< ${message}`);\r\n\r\n    // parse message\r\n    const [name, ...args] = message.split(\":\");\r\n\r\n    // attempt to handle command\r\n    this.handleWebSocketCommand(name, args, containers);\r\n  }\r\n\r\n  // handles parsed web-socket commands\r\n  private handleWebSocketCommand(\r\n    name: string,\r\n    args: string[],\r\n    containers: ContainerMap\r\n  ) {\r\n    const handler = this.webSocketCommandHandlers[name];\r\n\r\n    // check whether the handler exists\r\n    if (handler === undefined) {\r\n      console.warn(\r\n        `missing web-socket command handler for \"${name}\" (${args.join(\", \")})`\r\n      );\r\n\r\n      return;\r\n    }\r\n\r\n    // call the handler\r\n    handler(args, containers);\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nimport \"./MainMenu.scss\";\r\n\r\nconst MainMenu: React.SFC<{}> = () => (\r\n  <div className=\"main-menu\">\r\n    <ul className=\"main-menu__nav\">\r\n      <li>\r\n        <NavLink to=\"/status\" activeClassName=\"active\">\r\n          <div className=\"main-menu__nav__icon\">\r\n            <i className=\"icon icon__status\" />\r\n          </div>\r\n          <div className=\"main-menu__nav__text\">\r\n            <span>status</span>\r\n          </div>\r\n        </NavLink>\r\n      </li>\r\n      <li>\r\n        <NavLink to=\"/map\" activeClassName=\"active\">\r\n          <div className=\"main-menu__nav__icon\">\r\n            <i className=\"icon icon__map\" />\r\n          </div>\r\n          <div className=\"main-menu__nav__text\">\r\n            <span>map</span>\r\n          </div>\r\n        </NavLink>\r\n      </li>\r\n      <li>\r\n        <NavLink to=\"/ai\" activeClassName=\"active\">\r\n          <div className=\"main-menu__nav__icon\">\r\n            <i className=\"icon icon__bot\" />\r\n          </div>\r\n          <div className=\"main-menu__nav__text\">\r\n            <span>bot</span>\r\n          </div>\r\n        </NavLink>\r\n      </li>\r\n      <li>\r\n        <NavLink to=\"/remote\" activeClassName=\"active\">\r\n          <div className=\"main-menu__nav__icon\">\r\n            <i className=\"icon icon__remote\" />\r\n          </div>\r\n          <div className=\"main-menu__nav__text\">\r\n            <span>remote</span>\r\n          </div>\r\n        </NavLink>\r\n      </li>\r\n      <li>\r\n        <NavLink to=\"/settings\" activeClassName=\"active\">\r\n          <div className=\"main-menu__nav__icon\">\r\n            <i className=\"icon icon__settings\" />\r\n          </div>\r\n          <div className=\"main-menu__nav__text\">\r\n            <span>settings</span>\r\n          </div>\r\n        </NavLink>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n);\r\n\r\nexport default MainMenu;\r\n","import * as React from \"react\";\r\n\r\nconst BotView: React.SFC<{}> = () => <div className=\"view view--text bot-view\">Bot</div>;\r\n\r\nexport default BotView;\r\n","import classNames from \"classnames\";\r\nimport * as React from \"react\";\r\n\r\nimport \"./Grid.scss\";\r\n\r\nexport type GridProps = React.DetailedHTMLProps<React.HTMLAttributes<HTMLElement>, HTMLElement>;\r\nexport type GridItemProps = React.DetailedHTMLProps<React.HTMLAttributes<HTMLElement>, HTMLElement> & {\r\n  scrollToBottom?: boolean;\r\n};\r\n\r\nexport const Grid: React.SFC<GridProps> = ({ children, className }) => (\r\n  <div className={classNames(\"grid\", className)}>{children}</div>\r\n);\r\n\r\n// TODO: scroll to bottom on first render\r\nexport class GridItem extends React.Component<GridItemProps> {\r\n  private readonly ref = React.createRef<HTMLDivElement>();\r\n\r\n  componentDidUpdate() {\r\n    // return if scrolling to bottom is not requested\r\n    if (this.props.scrollToBottom !== true) {\r\n      return;\r\n    }\r\n\r\n    // get the dom node from the reference\r\n    const el = this.ref.current;\r\n\r\n    // return if element could not be found\r\n    if (!el) {\r\n      console.warn(\"grid item dom node not found\");\r\n\r\n      return;\r\n    }\r\n\r\n    // check whether we're aready near the bottom\r\n    const isNearBottom = el.scrollHeight - el.clientHeight <= el.scrollTop + 50;\r\n\r\n    // only force the scroll if near bottom\r\n    if (isNearBottom) {\r\n      el.scrollTop = el.scrollHeight - el.clientHeight;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div ref={this.ref} className={classNames(\"grid__item\", this.props.className)}>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Subscribe } from \"unstated\";\r\nimport OdometryContainer from \"../../containers/OdometryContainer\";\r\nimport { Grid, GridItem } from \"../../components/grid/Grid\";\r\n\r\nimport \"./MapView.scss\";\r\n\r\nconst MapView: React.SFC = () => (\r\n  <Subscribe to={[OdometryContainer]}>\r\n    {(odometryContainer: OdometryContainer) => (\r\n      <div className=\"view view--grid map-view\">\r\n        <Grid className=\"map-grid\">\r\n          <GridItem className=\"odometry\">\r\n            Left: {odometryContainer.state.left}\r\n          </GridItem>\r\n          <GridItem className=\"odometry\">\r\n            Right: {odometryContainer.state.right}\r\n          </GridItem>\r\n        </Grid>\r\n      </div>\r\n    )}\r\n  </Subscribe>\r\n);\r\n\r\nexport default MapView;\r\n","import * as nipplejs from \"nipplejs\";\r\nimport * as React from \"react\";\r\n\r\nexport interface JoystickProps {\r\n  name: string;\r\n  config?: nipplejs.JoystickOptions;\r\n  bind?: string;\r\n  onEvent?(\r\n    name: string,\r\n    event: nipplejs.JoystickEvent,\r\n    info: nipplejs.JoystickInstance\r\n  ): void;\r\n}\r\n\r\nexport default class Joystick extends React.Component<JoystickProps> {\r\n  private readonly ref = React.createRef<HTMLDivElement>();\r\n\r\n  componentDidMount() {\r\n    const el = this.ref.current;\r\n\r\n    // return if element could not be found\r\n    if (!el) {\r\n      console.warn(\"grid item dom node not found\");\r\n\r\n      return;\r\n    }\r\n\r\n    // create the nipple manager\r\n    const manager = nipplejs.create({\r\n      zone: el,\r\n      color: \"#FFF\",\r\n      size: 200,\r\n      position: {\r\n        left: \"50%\",\r\n        top: \"50%\"\r\n      },\r\n      mode: \"static\"\r\n    });\r\n\r\n    const { onEvent } = this.props;\r\n\r\n    // only listen for events if even listener has been added\r\n    if (typeof onEvent === \"function\") {\r\n      const bind = this.props.bind\r\n        ? this.props.bind\r\n        : \"start move end dir plain\";\r\n\r\n      manager\r\n        .on(bind, (event, nipple) => {\r\n          onEvent(this.props.name, event, nipple);\r\n        })\r\n        .on(\"removed\", (_event, nipple) => {\r\n          nipple.off(bind);\r\n        });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <div className=\"joystick\" ref={this.ref} />;\r\n  }\r\n}\r\n","export interface TrackedVehicleOptions {\r\n  trackWidth: number;\r\n  maxSpeed: number;\r\n  wheelDiameter: number;\r\n  encoderCountsPerRotation: number;\r\n  gearboxRatio: number;\r\n  speedUpdateInterval: number;\r\n}\r\n\r\nexport interface MotorSpeeds {\r\n  left: number;\r\n  right: number;\r\n}\r\n\r\n// https://pdfs.semanticscholar.org/29ae/0bc974737b58afd63b6edb8d0837a3383321.pdf\r\nexport default class TrackedVehicleKinematics {\r\n  constructor(private readonly options: TrackedVehicleOptions) {}\r\n\r\n  /**\r\n   * Returns motor speeds in m/s for requested forward speed at given rotational speed.\r\n   *\r\n   * @param speed Speed in m/s\r\n   * @param omega Rotational speed in rad/s\r\n   */\r\n  calculateMotorSpeeds(speed: number, omega: number): MotorSpeeds {\r\n    // TODO: calculate actual kinematics\r\n    return this.limit(\r\n      {\r\n        left: speed + omega,\r\n        right: speed - omega\r\n      },\r\n      this.options.maxSpeed\r\n    );\r\n  }\r\n\r\n  getSpeedEncoderCount(speed: number) {\r\n    const circumference = this.options.wheelDiameter * Math.PI;\r\n    const rps = speed / circumference;\r\n    const actualEncoderCountPerRevolution =\r\n      this.options.encoderCountsPerRotation * this.options.gearboxRatio;\r\n    const targetEncoderCountPerSecond = rps * actualEncoderCountPerRevolution;\r\n\r\n    return Math.floor(targetEncoderCountPerSecond);\r\n  }\r\n\r\n  limit(speeds: MotorSpeeds, maxSpeed: number): MotorSpeeds {\r\n    const maxRequestedSpeedMagnitude = Math.max(\r\n      Math.abs(speeds.left),\r\n      Math.abs(speeds.right)\r\n    );\r\n    const normalizationFactor = Math.min(\r\n      maxSpeed / maxRequestedSpeedMagnitude,\r\n      1.0\r\n    );\r\n\r\n    // console.log(\"normalize\", {\r\n    //   maxRequestedSpeedMagnitude,\r\n    //   normalizationFactor,\r\n    //   speeds,\r\n    //   maxSpeed,\r\n    // });\r\n\r\n    return {\r\n      left: speeds.left * normalizationFactor,\r\n      right: speeds.right * normalizationFactor\r\n    };\r\n  }\r\n\r\n  getEncoderSpeeds(speeds: MotorSpeeds): MotorSpeeds {\r\n    return {\r\n      left: this.getSpeedEncoderCount(speeds.left),\r\n      right: this.getSpeedEncoderCount(speeds.right)\r\n    };\r\n  }\r\n}\r\n","import throttle from \"lodash.throttle\";\r\nimport { dummyLogger, Logger } from \"ts-log\";\r\n\r\nimport WebSocketClient from \"../web-socket-client/index\";\r\nimport TrackedVehicleKinematics, {\r\n  TrackedVehicleOptions\r\n} from \"../tracked-vehicle-kinematics\";\r\n\r\nexport interface RemoteControllerOptions {\r\n  webSocketClient: WebSocketClient;\r\n  vehicle: TrackedVehicleOptions;\r\n  log?: Logger;\r\n}\r\n\r\nexport default class RemoteController {\r\n  private readonly options: Required<RemoteControllerOptions>;\r\n  private readonly kinematics: TrackedVehicleKinematics;\r\n  private speed = 0;\r\n  private omega = 0;\r\n  private readonly scheduleUpdateMotorSpeeds: () => void;\r\n\r\n  constructor(options: RemoteControllerOptions) {\r\n    this.options = {\r\n      log: dummyLogger,\r\n      ...options\r\n    };\r\n    this.kinematics = new TrackedVehicleKinematics(this.options.vehicle);\r\n\r\n    this.scheduleUpdateMotorSpeeds = throttle(\r\n      () => this.updateMotorSpeeds(),\r\n      this.options.vehicle.speedUpdateInterval\r\n    );\r\n  }\r\n\r\n  setSpeed(speed: number) {\r\n    this.speed = speed;\r\n\r\n    this.scheduleUpdateMotorSpeeds();\r\n  }\r\n\r\n  setOmega(omega: number) {\r\n    this.omega = omega;\r\n\r\n    this.scheduleUpdateMotorSpeeds();\r\n  }\r\n\r\n  private updateMotorSpeeds() {\r\n    const motorSpeeds = this.kinematics.calculateMotorSpeeds(\r\n      this.speed,\r\n      this.omega\r\n    );\r\n    const encoderSpeeds = this.kinematics.getEncoderSpeeds(motorSpeeds);\r\n\r\n    // TODO: only send if sufficiently different from last sent values\r\n    this.options.webSocketClient.send(\r\n      `set-speed:${encoderSpeeds.left}:${encoderSpeeds.right}`\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport Joystick from \"../../components/joystick/Joystick\";\r\nimport { JoystickEvent, JoystickEventName, JoystickInstance } from \"nipplejs\";\r\nimport config from \"../../config\";\r\nimport RemoteController from \"../../lib/remote-controller\";\r\nimport webSocketClient from \"../../services/webSocketClient\";\r\n\r\nimport \"./RemoteView.scss\";\r\n\r\n// TODO: show track speeds on edges (target and real)\r\nexport default class RemoteView extends React.Component {\r\n  private readonly remoteController = new RemoteController({\r\n    webSocketClient,\r\n    log: console,\r\n    vehicle: config.vehicle\r\n  });\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"view view--grid remote-view\">\r\n        <div className=\"joystick-grid\">\r\n          <div className=\"joystick-grid__item\">\r\n            <Joystick\r\n              name=\"speed\"\r\n              onEvent={(name, event, info) =>\r\n                this.onJoystickEvent(name, event, info)\r\n              }\r\n            />\r\n          </div>\r\n          <div className=\"joystick-grid__item\">\r\n            <Joystick\r\n              name=\"omega\"\r\n              onEvent={(name, event, info) =>\r\n                this.onJoystickEvent(name, event, info)\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private onJoystickEvent(\r\n    name: string,\r\n    event: JoystickEvent,\r\n    info: JoystickInstance\r\n  ) {\r\n    const interestingEvents: JoystickEventName[] = [\"move\", \"end\"];\r\n\r\n    if (interestingEvents.indexOf(event.type) === -1) {\r\n      return;\r\n    }\r\n\r\n    const isMoveEvent = event.type === \"move\";\r\n\r\n    const xPos = isMoveEvent ? Math.sin(info.angle.radian) * info.distance : 0;\r\n    const yPos = isMoveEvent ? Math.cos(info.angle.radian) * info.distance : 0;\r\n\r\n    // console.log(`${name} x: ${xPos}, y: ${yPos}, distance: ${info.distance}`, this.remoteController);\r\n\r\n    switch (name) {\r\n      case \"speed\":\r\n        this.remoteController.setSpeed((yPos * -1) / 100.0);\r\n        break;\r\n\r\n      case \"omega\":\r\n        this.remoteController.setOmega(xPos / 100.0);\r\n        break;\r\n\r\n      default:\r\n        throw new Error(`Got unexpected joystick \"${name}\" info`);\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nconst SettingsView: React.SFC<{}> = () => <div className=\"view view--text settings-view\">\r\n  <button onClick={() => window.location.href = \"http://kallaspriit\"}>Open http://kallaspriit</button>\r\n</div>;\r\n\r\nexport default SettingsView;\r\n","import classNames from \"classnames\";\r\nimport * as React from \"react\";\r\n\r\nexport type IconProps = React.DetailedHTMLProps<\r\n  React.HTMLAttributes<HTMLElement>,\r\n  HTMLElement\r\n> & {\r\n  name: string;\r\n  width?: string | number;\r\n  height?: string | number;\r\n};\r\n\r\nconst Icon: React.SFC<IconProps> = ({\r\n  children,\r\n  name,\r\n  width,\r\n  height,\r\n  className\r\n}) => (\r\n  <i\r\n    className={classNames(\"icon\", `icon__${name}`, className)}\r\n    style={getStyle(width, height)}\r\n  >\r\n    {children}\r\n  </i>\r\n);\r\n\r\nfunction getStyle(\r\n  width: string | number | undefined,\r\n  height: string | number | undefined\r\n): React.CSSProperties {\r\n  const style: React.CSSProperties = {};\r\n\r\n  if (typeof width === \"string\") {\r\n    style.width = `${width}${\r\n      parseFloat(width).toString() === width ? \"px\" : \"\"\r\n    }`;\r\n  } else if (typeof width === \"number\") {\r\n    style.width = `${width}px`;\r\n  }\r\n\r\n  if (typeof height === \"string\") {\r\n    style.height = `${height}${\r\n      parseFloat(height).toString() === height ? \"px\" : \"\"\r\n    }`;\r\n  } else if (typeof height === \"number\") {\r\n    style.height = `${height}px`;\r\n  }\r\n\r\n  return style;\r\n}\r\n\r\nexport default Icon;\r\n","export default function pad(\r\n  data: string | number,\r\n  length: number,\r\n  padder = \" \"\r\n): string {\r\n  const str = typeof data === \"string\" ? data : data.toString();\r\n\r\n  // return as is if already long enough\r\n  if (str.length >= length) {\r\n    return str;\r\n  }\r\n\r\n  const missingLength = length - str.length;\r\n\r\n  return `${new Array(missingLength + 1).join(padder)}${str}`;\r\n}\r\n","import classNames from \"classnames\";\r\nimport * as React from \"react\";\r\nimport titleCase from \"title-case\";\r\nimport { Subscribe } from \"unstated\";\r\n\r\nimport { Grid, GridItem } from \"../../components/grid/Grid\";\r\nimport Icon from \"../../components/icon/Icon\";\r\nimport LogContainer from \"../../containers/LogContainer\";\r\nimport StatusContainer, {\r\n  BatteryState,\r\n  SerialType\r\n} from \"../../containers/StatusContainer\";\r\nimport { WebSocketState } from \"../../lib/web-socket-client/index\";\r\nimport assertUnreachable from \"../../services/assertUnreachable\";\r\nimport formatTime from \"../../services/formatTime\";\r\n\r\nimport \"./StatusView.scss\";\r\n\r\n// TODO: add motor controller, http server, IMU, heartbeat\r\nconst StatusView: React.SFC = () => (\r\n  <Subscribe to={[LogContainer, StatusContainer]}>\r\n    {(logContainer: LogContainer, statusContainer: StatusContainer) => {\r\n      const connectedSerial = statusContainer.getConnectedSerial();\r\n\r\n      return (\r\n        <div className=\"view view--grid status-view\">\r\n          <Grid className=\"status-grid\">\r\n            <GridItem\r\n              className={classNames(\r\n                \"grid-status\",\r\n                connectedSerial !== undefined ? \"bg--good\" : \"bg--bad\"\r\n              )}\r\n            >\r\n              <div className=\"grid__icon\">\r\n                <i\r\n                  className={\r\n                    connectedSerial &&\r\n                    connectedSerial.type === SerialType.BLUETOOTH\r\n                      ? \"icon icon__bluetooth\"\r\n                      : \"icon icon__serial\"\r\n                  }\r\n                />\r\n              </div>\r\n              <div className=\"grid__text\">\r\n                <div className=\"grid__text--primary\">\r\n                  {connectedSerial ? connectedSerial.type : \"Serial\"}\r\n                </div>\r\n                <div className=\"grid__text--secondary\">\r\n                  {titleCase(\r\n                    connectedSerial ? connectedSerial.state : \"Disconnected\"\r\n                  )}\r\n                  {connectedSerial && connectedSerial.deviceName\r\n                    ? `: ${connectedSerial.deviceName}`\r\n                    : \"\"}\r\n                </div>\r\n              </div>\r\n            </GridItem>\r\n            <GridItem\r\n              className={classNames(\r\n                \"grid-status\",\r\n                statusContainer.state.webSocketState ===\r\n                  WebSocketState.CONNECTED\r\n                  ? \"bg--good\"\r\n                  : \"bg--bad\"\r\n              )}\r\n            >\r\n              <div className=\"grid__icon\">\r\n                <i className=\"icon icon__web-socket\" />\r\n              </div>\r\n              <div className=\"grid__text\">\r\n                <div className=\"grid__text--primary\">Web Socket</div>\r\n                <div className=\"grid__text--secondary\">\r\n                  {statusContainer.state.webSocketState !==\r\n                    WebSocketState.CONNECTED &&\r\n                  statusContainer.state.remoteIp !== undefined\r\n                    ? titleCase(statusContainer.state.webSocketState)\r\n                    : statusContainer.state.remoteIp}\r\n                </div>\r\n              </div>\r\n            </GridItem>\r\n            <GridItem\r\n              className={classNames(\r\n                \"grid-status\",\r\n                getBatteryLevelClass(statusContainer.batteryState)\r\n              )}\r\n            >\r\n              <div className=\"grid__icon\">\r\n                <i className=\"icon icon__battery\" />\r\n              </div>\r\n              <div className=\"grid__text\">\r\n                <div className=\"grid__text--primary\">Battery</div>\r\n                <div className=\"grid__text--secondary\">\r\n                  {statusContainer.state.batteryVoltage\r\n                    ? `${statusContainer.state.batteryVoltage.toFixed(1)}V`\r\n                    : \"Unknown\"}\r\n                </div>\r\n              </div>\r\n            </GridItem>\r\n            <GridItem className=\"log\" scrollToBottom={true}>\r\n              {logContainer.state.entries.map(entry => (\r\n                <div className=\"log__entry\" key={entry.id}>\r\n                  <span className=\"log__entry__time\">\r\n                    {formatTime(entry.time)}\r\n                  </span>{\" \"}\r\n                  <span className=\"log__entry__message\">{entry.message}</span>\r\n                </div>\r\n              ))}\r\n            </GridItem>\r\n          </Grid>\r\n          <div\r\n            className=\"clear-log-button\"\r\n            onClick={() => logContainer.clear()}\r\n          >\r\n            <Icon name=\"clear\" />\r\n          </div>\r\n        </div>\r\n      );\r\n    }}\r\n  </Subscribe>\r\n);\r\n\r\nfunction getBatteryLevelClass(batteryState: BatteryState): string {\r\n  switch (batteryState) {\r\n    case BatteryState.UNKNOWN:\r\n      return \"bg--warn\";\r\n\r\n    case BatteryState.FULL:\r\n      return \"bg--good\";\r\n\r\n    case BatteryState.LOW:\r\n      return \"bg--warn\";\r\n\r\n    case BatteryState.CRITICAL:\r\n      return \"bg--bad\";\r\n\r\n    default:\r\n      return assertUnreachable(batteryState, \"got unexpected battery state\");\r\n  }\r\n}\r\n\r\nexport default StatusView;\r\n","export default function assertUnreachable(\r\n  value: never,\r\n  message: string\r\n): never {\r\n  throw new Error(`${message} (${value})`);\r\n}\r\n","import pad from \"./pad\";\r\n\r\nexport default function formatTime(date: Date): string {\r\n  return (\r\n    `${pad(date.getHours(), 2, \"0\")}:` +\r\n    `${pad(date.getMinutes(), 2, \"0\")}:` +\r\n    `${pad(date.getSeconds(), 2, \"0\")}.` +\r\n    `${pad(date.getMilliseconds(), 3, \"0\")}`\r\n  );\r\n}\r\n","import * as React from \"react\";\nimport {\n  BrowserRouter as Router,\n  Redirect,\n  Route,\n  Switch\n} from \"react-router-dom\";\nimport { Provider } from \"unstated\";\n\nimport ConnectionManager from \"./components/glue/ConnectionManager\";\nimport MainMenu from \"./components/main-menu/MainMenu\";\nimport BotView from \"./views/bot/BotView\";\nimport MapView from \"./views/map/MapView\";\nimport RemoteView from \"./views/remote/RemoteView\";\nimport SettingsView from \"./views/settings/SettingsView\";\nimport StatusView from \"./views/status/StatusView\";\n\nclass App extends React.Component {\n  render() {\n    return (\n      <Provider>\n        <ConnectionManager />\n        <Router>\n          <div className=\"app\">\n            <Switch>\n              <Route path=\"/status\" component={StatusView} />\n              <Route path=\"/map\" component={MapView} />\n              <Route path=\"/remote\" component={RemoteView} />\n              <Route path=\"/ai\" component={BotView} />\n              <Route path=\"/settings\" component={SettingsView} />\n              <Route exact={true} path=\"/\">\n                <Redirect to=\"/status\" />\n              </Route>\n            </Switch>\n            <MainMenu />\n          </div>\n        </Router>\n      </Provider>\n    );\n  }\n}\n\nexport default App;\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\n\nimport \"reset-css\";\nimport \"./index.scss\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}